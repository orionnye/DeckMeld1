function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},a=t.parcelRequire8057;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var a={id:e,exports:{}};return n[e]=a,t.call(a.exports,a,a.exports),a.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){i[e]=t},t.parcelRequire8057=a),a.register("27Lyk",(function(t,n){var i,a;e(t.exports,"register",(()=>i),(e=>i=e)),e(t.exports,"resolve",(()=>a),(e=>a=e));var s={};i=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)s[t[n]]=e[t[n]]},a=function(e){var t=s[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a.register("h9utD",(function(e,t){e.exports=new URL(a("27Lyk").resolve("1Ntva"),import.meta.url).toString()})),a.register("fhysK",(function(e,t){e.exports=new URL(a("27Lyk").resolve("lvMDJ"),import.meta.url).toString()})),a.register("8uhqy",(function(e,t){e.exports=new URL(a("27Lyk").resolve("i5xkB"),import.meta.url).toString()})),a.register("3LBcK",(function(e,t){e.exports=new URL(a("27Lyk").resolve("gH1Or"),import.meta.url).toString()})),a.register("kENkU",(function(e,t){e.exports=new URL(a("27Lyk").resolve("lVG3x"),import.meta.url).toString()})),a.register("gb6Jt",(function(e,t){e.exports=new URL(a("27Lyk").resolve("jtKuZ"),import.meta.url).toString()})),a.register("fSjwC",(function(e,t){e.exports=new URL(a("27Lyk").resolve("kL1YC"),import.meta.url).toString()})),a.register("jPL73",(function(e,t){e.exports=new URL(a("27Lyk").resolve("52U4m"),import.meta.url).toString()})),a.register("eOAT7",(function(e,t){e.exports=new URL(a("27Lyk").resolve("dOBRO"),import.meta.url).toString()})),a.register("ckBlf",(function(e,t){e.exports=new URL(a("27Lyk").resolve("gT0Zu"),import.meta.url).toString()})),a.register("11iVL",(function(e,t){e.exports=new URL(a("27Lyk").resolve("cUtHr"),import.meta.url).toString()})),a.register("j8ho2",(function(e,t){e.exports=new URL(a("27Lyk").resolve("2GBAK"),import.meta.url).toString()})),a.register("gqipq",(function(e,t){e.exports=new URL(a("27Lyk").resolve("5AP31"),import.meta.url).toString()})),a.register("6ftts",(function(e,t){e.exports=new URL(a("27Lyk").resolve("dVcqF"),import.meta.url).toString()})),a.register("3bAft",(function(e,t){e.exports=new URL(a("27Lyk").resolve("8SU7g"),import.meta.url).toString()})),a.register("eK07Y",(function(e,t){e.exports=new URL(a("27Lyk").resolve("8iSqe"),import.meta.url).toString()})),a.register("6apJ1",(function(e,t){e.exports=new URL(a("27Lyk").resolve("cLwn2"),import.meta.url).toString()})),a.register("cShrF",(function(e,t){e.exports=new URL(a("27Lyk").resolve("3wsni"),import.meta.url).toString()})),a.register("6i3cT",(function(e,t){e.exports=new URL(a("27Lyk").resolve("84CUC"),import.meta.url).toString()})),a.register("3yIQk",(function(e,t){e.exports=new URL(a("27Lyk").resolve("jMTFx"),import.meta.url).toString()})),a.register("gqAfu",(function(e,t){e.exports=new URL(a("27Lyk").resolve("a9P2a"),import.meta.url).toString()})),a.register("3QXkh",(function(e,t){e.exports=new URL(a("27Lyk").resolve("7TrJz"),import.meta.url).toString()})),a.register("2FSE5",(function(e,t){e.exports=new URL(a("27Lyk").resolve("2iNK1"),import.meta.url).toString()})),a.register("60iqD",(function(e,t){e.exports=new URL(a("27Lyk").resolve("fFSfK"),import.meta.url).toString()})),a.register("eLkWC",(function(e,t){e.exports=new URL(a("27Lyk").resolve("gV6tH"),import.meta.url).toString()})),a.register("llwLD",(function(e,t){e.exports=new URL(a("27Lyk").resolve("98LW9"),import.meta.url).toString()})),a.register("e5RPM",(function(e,t){e.exports=new URL(a("27Lyk").resolve("7dFi9"),import.meta.url).toString()})),a.register("36AKi",(function(e,t){e.exports=new URL(a("27Lyk").resolve("fHPrZ"),import.meta.url).toString()})),a.register("5umeh",(function(e,t){e.exports=new URL(a("27Lyk").resolve("bgHtf"),import.meta.url).toString()})),a.register("lS59Y",(function(e,t){e.exports=new URL(a("27Lyk").resolve("a366i"),import.meta.url).toString()})),a.register("1nBTg",(function(e,t){e.exports=new URL(a("27Lyk").resolve("22lZr"),import.meta.url).toString()})),a.register("tpHuI",(function(e,t){e.exports=new URL(a("27Lyk").resolve("1s5R0"),import.meta.url).toString()})),a.register("blSrT",(function(e,t){e.exports=new URL(a("27Lyk").resolve("6Pi2O"),import.meta.url).toString()})),a.register("bJEKW",(function(e,t){e.exports=new URL(a("27Lyk").resolve("3xD1x"),import.meta.url).toString()})),a.register("6U9tT",(function(e,t){e.exports=new URL(a("27Lyk").resolve("cjRqQ"),import.meta.url).toString()})),a.register("OIsvx",(function(e,t){e.exports=new URL(a("27Lyk").resolve("bwifq"),import.meta.url).toString()})),a.register("kMkUa",(function(e,t){e.exports=new URL(a("27Lyk").resolve("iuNEp"),import.meta.url).toString()})),a.register("j7Onr",(function(e,t){e.exports=new URL(a("27Lyk").resolve("iOTLM"),import.meta.url).toString()})),a.register("emB6h",(function(e,t){e.exports=new URL(a("27Lyk").resolve("ac7FO"),import.meta.url).toString()})),a.register("9QqEy",(function(e,t){e.exports=new URL(a("27Lyk").resolve("lOtdr"),import.meta.url).toString()})),a.register("5hfr4",(function(e,t){e.exports=new URL(a("27Lyk").resolve("iPZUs"),import.meta.url).toString()})),a.register("Wkcxi",(function(e,t){e.exports=new URL(a("27Lyk").resolve("ilUqy"),import.meta.url).toString()})),a.register("lfCUM",(function(e,t){e.exports=new URL(a("27Lyk").resolve("4G08l"),import.meta.url).toString()})),a.register("fw68x",(function(e,t){e.exports=new URL(a("27Lyk").resolve("3l74Z"),import.meta.url).toString()})),a.register("afCUm",(function(e,t){e.exports=new URL(a("27Lyk").resolve("iGhmO"),import.meta.url).toString()})),a.register("30jZt",(function(e,t){e.exports=new URL(a("27Lyk").resolve("8ho0c"),import.meta.url).toString()})),a.register("5HLz4",(function(e,t){e.exports=new URL(a("27Lyk").resolve("7ZN5Q"),import.meta.url).toString()})),a.register("cwVfH",(function(e,t){e.exports=new URL(a("27Lyk").resolve("6NsjC"),import.meta.url).toString()})),a.register("6nzMk",(function(e,t){e.exports=new URL(a("27Lyk").resolve("fkvli"),import.meta.url).toString()})),a.register("1nAOW",(function(e,t){e.exports=new URL(a("27Lyk").resolve("2Ayx5"),import.meta.url).toString()})),a.register("kB1Dc",(function(e,t){e.exports=new URL(a("27Lyk").resolve("2V8nT"),import.meta.url).toString()})),a.register("fFTut",(function(e,t){e.exports=new URL(a("27Lyk").resolve("h38Gm"),import.meta.url).toString()})),a.register("gLbfg",(function(e,t){e.exports=new URL(a("27Lyk").resolve("l34qm"),import.meta.url).toString()})),a.register("3EpHn",(function(e,t){e.exports=new URL(a("27Lyk").resolve("bpkt7"),import.meta.url).toString()})),a.register("ljcCv",(function(e,t){e.exports=new URL(a("27Lyk").resolve("aAEpa"),import.meta.url).toString()})),a.register("eqjSU",(function(e,t){e.exports=new URL(a("27Lyk").resolve("2RzGY"),import.meta.url).toString()})),a.register("6AVs7",(function(e,t){e.exports=new URL(a("27Lyk").resolve("7BlcN"),import.meta.url).toString()})),a.register("fwkUW",(function(e,t){e.exports=new URL(a("27Lyk").resolve("bO2Wm"),import.meta.url).toString()})),a("27Lyk").register(JSON.parse('{"dZpbI":"index.ad6db622.js","1Ntva":"grassFlipped.5db800e2.png","lvMDJ":"hill5.71ce96e7.png","i5xkB":"ShallowWater.0acbc1d7.png","gH1Or":"DeepWater.51a9c4d4.png","lVG3x":"ancientmech.d2b58418.png","jtKuZ":"pustule.2c97757f.png","kL1YC":"card.ffefd8a2.png","52U4m":"laser.e2917381.png","dOBRO":"EnergyArmor.91bbd9a2.png","gT0Zu":"ShieldCharge.93b851ee.png","cUtHr":"energyFist.dd669ee0.png","2GBAK":"barrier.ae85dd2c.png","5AP31":"boulder.0f1b3003.png","dVcqF":"mine.9c0fde6d.png","8SU7g":"gorge.f76efd83.png","8iSqe":"blastCharge.c12540c9.png","cLwn2":"dynamite.8c68b21f.png","3wsni":"plating.c0f37ca4.png","84CUC":"claw.9b122a62.png","jMTFx":"frendzi.5208d098.png","a9P2a":"leap.f074414d.png","7TrJz":"lump.75a0340c.png","2iNK1":"chomp.8b5efbc8.png","fFSfK":"acid.9c24e68b.png","gV6tH":"bloodClot.7ebcff0c.png","98LW9":"sprint.0ec05625.png","7dFi9":"repair.f2631c26.png","fHPrZ":"grapplingHook.694cda09.png","bgHtf":"Gun.ff3b07e1.png","a366i":"pollen.ace413e3.png","22lZr":"fruit.14086b5f.png","1s5R0":"root.f730cd59.png","6Pi2O":"flower.02b2d95d.png","3xD1x":"bark.98f9cbef.png","cjRqQ":"fungus.675dc5de.png","bwifq":"boomShroom.2553e318.png","iuNEp":"worms.a725db08.png","iOTLM":"jelly.ad1c7988.png","ac7FO":"tentacle.5303b84a.png","lOtdr":"warp.c2153036.png","iPZUs":"frost.0f1da465.png","ilUqy":"flesh.ee34fa2e.png","4G08l":"BlackCardBase.7fe05243.png","3l74Z":"BrownCardBase.709c729a.png","iGhmO":"jungle.0579f7d9.png","8ho0c":"metal.0bbc6e92.png","7ZN5Q":"purple.9bb8f249.png","6NsjC":"grass.2dd11e56.png","fkvli":"ChromeMech2.9ff9692c.png","2Ayx5":"Vinecent2.81f341a5.png","2V8nT":"EarthMech.f0d58cbe.png","h38Gm":"flesh3.47652314.png","l34qm":"GellyMech.1cc0ecc3.png","bpkt7":"BackgroundPixel1.abf6fd00.png","aAEpa":"BackgroundPixel2.65a37ceb.png","2RzGY":"BackgroundPixel3.0f6d9f6f.png","7BlcN":"BackgroundPixel4.9a699cfd.png","bO2Wm":"grunt.10e90e0d.png","cgtuV":"Vacation.3e7a8d6e.mp3","eLZc0":"Knock.46cab22d.mp3"}'));function s(e,t){return Math.abs(e-t)<1e-5}function r(e){return Math.floor(Math.random()*e)}function o(e){return Math.random()*e}function l(e,t,n){return n>=e&&n<=t}function c(e,t,n){return n<e?e:n>t?t:n}function h(e,t,n){return(t-e)*n+e}class d{constructor(e,t){this.x=e,this.y=t}subtract(e){return new d(this.x-e.x,this.y-e.y)}add(e){return new d(this.x+e.x,this.y+e.y)}addXY(e,t){return new d(this.x+e,this.y+t)}product(e){return new d(this.x*e.x,this.y*e.y)}scale(e){return new d(this.x*e,this.y*e)}floor(){return new d(Math.floor(this.x),Math.floor(this.y))}ceil(){return new d(Math.ceil(this.x),Math.ceil(this.y))}distance(e){return this.subtract(e).length}equals(e){return null!=e&&(s(this.x,e.x)&&s(this.y,e.y))}signs(){return new d(Math.sign(this.x),Math.sign(this.y))}lerp(e,t){let n=1-t;return new d(this.x*n+e.x*t,this.y*n+e.y*t)}get length(){return Math.sqrt(this.x**2+this.y**2)}toString(){return this.x+","+this.y}unit(){return this.scale(1/this.length)}clampLength(e,t){let n=this.length,i=this.scale(1/n);return n=c(e,t,n),i.scale(n)}static lissajous(e,t,n,i=1,a=i,s=0,r=0){return new d(Math.cos(2*Math.PI*(e+s)*t)*i,Math.sin(2*Math.PI*(e+r)*n)*a)}}d.zero=new d(0,0),d.one=new d(1,1),d.right=new d(1,0),d.down=new d(0,1);class p{constructor(e,t,n,i,a,s,r,o,l){this.m11=0,this.m12=0,this.m13=0,this.m21=0,this.m22=0,this.m23=0,this.m31=0,this.m32=0,this.m33=0,this.m11=e,this.m12=t,this.m13=n,this.m21=i,this.m22=a,this.m23=s,this.m31=r,this.m32=o,this.m33=l}multiply(e){return f(this,e,p)}inverse(){return x(this,p)}determinant(){return w(this,p)}equals(e){return T(this,e,1e-6,p)}multiplyVec(e,t=1){let{m11:n,m12:i,m13:a,m21:s,m22:r,m23:o}=this,{x:l,y:c}=e;return new d(n*l+i*c+a*t,s*l+r*c+o*t)}static translation(e=0,t=0){return new p(1,0,e,0,1,t,0,0,1)}translate(e=0,t=0){return this.multiply(p.translation(e,t))}static vTranslation(e){return new p(1,0,e.x,0,1,e.y,0,0,1)}vTranslate(e){return this.multiply(p.vTranslation(e))}static rotation(e=0){let t=Math.sin(e),n=Math.cos(e);return new p(n,-t,0,t,n,0,0,0,1)}rotate(e=0){return this.multiply(p.rotation(e))}static scale(e=1,t=1){return new p(e,0,0,0,t,0,0,0,1)}scale(e=1,t=1){return this.multiply(p.scale(e,t))}static transformation(e,t,n,i,a,s,r){let o=e,l=t,c=n,h=i,d=a,m=s,g=r,y=Math.sin(c),u=Math.cos(c);return new p(h*u,-d*y,o*h*u-l*d*y+m,h*y,d*u,o*h*y+l*d*u+g,0,0,1)}static scaleAndTranslate(e,t,n){return new p(e,0,t,0,e,n,0,0,1)}print(){let{m11:e,m12:t,m13:n,m21:i,m22:a,m23:s,m31:r,m32:o,m33:l}=this,c=[[e,t,n],[i,a,s],[r,o,l]],h=[[e,i,r],[t,a,o],[n,s,l]].map((e=>e.map((e=>e.toString().length)).reduce(((e,t)=>Math.max(e,t))))),d=(e,t)=>e.toString().padStart(h[t]),p=c.map((e=>"| "+e.map(d).join("  ")+" |")).join("\n");console.log(p)}}function m(e){let t=[];for(let n=1;n<=e;n++)t.push(n);return t}function g(e,t,n,i){return"( "+e+" * "+i+" - "+t+" * "+n+" )"}function y(e){let[t,n,i,a,s,r,o,l,c]=e;return`(${t} * ${g(s,r,l,c)} -\n    ${n} * ${g(a,r,o,c)} +\n    ${i} * ${g(a,s,o,l)})`}function u(e){return"let {\n    "+m(3).map((t=>m(3).map((n=>"m"+t+n+": "+e+t+n)).join(", "))).join(",\n    ")+"\n} = "+e}p.identity=new p(1,0,0,0,1,0,0,0,1);const w=(()=>{let e="return "+y(m(3).map((e=>m(3).map((t=>"A.m"+e+t)))).flat());return new Function("A","Matrix3",e)})(),f=(()=>{let e=[u("A"),u("B"),`return new Matrix3(\n    ${m(3).map((e=>m(3).map((t=>m(3).map((n=>"A"+e+n+" * B"+n+t)).join(" + "))).join(", "))).join(",\n    ")}\n)`].join("\n");return new Function("A","B","Matrix3",e)})(),x=(()=>{let e=(e,t,n,i)=>g("A"+e,"A"+t,"A"+n,"A"+i),t=[u("A"),"let c = 1 / "+y(m(3).map((e=>m(3).map((t=>"A"+e+t)))).flat()),`\nreturn new Matrix3(${[[e(22,23,32,33),"-"+e(12,13,32,33),e(12,13,22,23)],["-"+e(21,23,31,33),e(11,13,31,33),"-"+e(11,13,21,23)],[e(21,22,31,32),"-"+e(11,12,31,32),e(11,12,21,22)]].map((e=>e.map((e=>e+" * c")).join(", "))).join(",\n    ")})`].join("\n");return new Function("A","Matrix3",t)})(),T=(()=>{let e=[u("A"),u("B"),...m(3).map((e=>m(3).map((t=>{let n=e.toString()+t.toString();return`if (Math.abs(A${n} - B${n}) > epsilon) return false`})))).flat(),"return true"].join("\n");return new Function("A","B","epsilon","Matrix3",e)})();function b(e){let t=new Image;return t.src=e,t}class k{constructor(){k.instance=this,this.canvas=document.getElementById("canvas1"),this.c=this.canvas.getContext("2d"),this.onResize()}onResize(){let{canvas:e}=this,t=e.getBoundingClientRect();e.width=t.width,e.height=t.height,this.size=new d(this.canvas.width,this.canvas.height)}vTranslate(e){this.c.translate(e.x,e.y)}drawRect(e,t,n="red"){this.c.fillStyle=n,this.c.fillRect(e.x,e.y,t.x,t.y)}drawRoundRect(e,t,n="black",i){this.c.fillStyle=n,this.c.beginPath(),this.c.moveTo(e.x+i,e.y),this.c.arcTo(e.x+t.x,e.y,e.x+t.x,e.y+t.y,i),this.c.arcTo(e.x+t.x,e.y+t.y,e.x,e.y+t.y,i),this.c.arcTo(e.x,e.y+t.y,e.x,e.y,i),this.c.arcTo(e.x,e.y,e.x+t.x,e.y,i),this.c.closePath(),this.c.fill()}strokeRect(e,t,n="black"){this.c.strokeStyle=n,this.c.beginPath(),this.c.strokeRect(e.x,e.y,t.x,t.y)}strokeCircle(e,t,n="black"){this.c.beginPath(),this.c.arc(e.x,e.y,t,0,2*Math.PI),this.c.strokeStyle=n,this.c.stroke()}fillCircle(e,t,n="black"){this.c.beginPath(),this.c.arc(e.x,e.y,t,0,2*Math.PI),this.c.fillStyle=n,this.c.fill()}drawPip(e,t,n="white",i="black"){this.drawRect(e,t,n),this.strokeRect(e,t,i)}pipBlock(e,t,n,i,a=!1,s="white",r="black"){let o=t;a?o.y=o.y/(i+1):o.x=o.x/(i+1);let l=o.scale(1/(i-1));this.c.lineWidth=.1;for(let t=0;t<i;t++){let i=e;i=a?i.add(new d(0,o.y*t+l.y*t)):i.add(new d(l.x*t+o.x*t,0)),t<n?this.drawPip(i,o,s,"black"):this.drawPip(i,o,r)}}costDisplay(e,t,n,i,a=10){this.drawRect(e.add(new d(1.5,1)),new d(7,8),i),this.setFont(a,"pixel2"),this.drawText(e.add(new d(1.5,1)),t,n)}makePath(e){if(0!=e.length){this.c.beginPath(),this.c.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)this.c.lineTo(e[t].x,e[t].y)}}setFont(e,t){this.c.font=e+"px "+t}textDimensions(e){let t=this.c.measureText(e);return new d(t.width,t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)}drawText(e,t,n,i){let a=i?.padding??1,s=n??"white",r=(i?.boxColor,i?.alignX??S.left),o=i?.alignY??R.top,l=this.c.measureText(t),c=a,h=2*a,p=new d(l.width,l.actualBoundingBoxAscent+l.actualBoundingBoxDescent).addXY(h,h),m=e.addXY(-p.x*r,-p.y*o).addXY(c,c+l.actualBoundingBoxAscent);return this.c.fillStyle=s,this.c.fillText(t,m.x,m.y),p}drawTextBox(e,t,n){let i=n.padding??1,a=n.textColor??"white",s=n.boxColor??"black",r=n.alignX??S.left,o=n.alignY??R.top,l=this.c.measureText(t),c=i,h=2*i,p=new d(l.width,l.actualBoundingBoxAscent+l.actualBoundingBoxDescent).addXY(h,h),m=e.addXY(-p.x*r,-p.y*o),g=m.addXY(c,c+l.actualBoundingBoxAscent);return this.drawRect(m,p,s),this.drawText(g,t,a),p}drawRoundTextBox(e,t,n){let i=n.padding??1,a=n.textColor??"white",s=n.boxColor??"black",r=n.alignX??S.left,o=n.alignY??R.top,l=n.borderRadius??0,c=this.c.measureText(t),h=i,p=2*i,m=new d(c.width,c.actualBoundingBoxAscent+c.actualBoundingBoxDescent).addXY(p,p),g=e.addXY(-m.x*r,-m.y*o),y=g.addXY(h,h+c.actualBoundingBoxAscent);return this.drawRoundRect(g,m,s,l),this.drawText(y,t,a),m}drawSheetFrame(e,t,n,i,a){let s=e.width,r=t;this.c.drawImage(e,0,r*a,s,r,n,i,s,r)}}let S,R;!function(e){e[e.left=0]="left",e[e.center=.5]="center",e[e.right=1]="right"}(S||(S={})),function(e){e[e.top=0]="top",e[e.center=.5]="center",e[e.bottom=1]="bottom"}(R||(R={}));class v extends class{constructor(e){this.name=e.name}}{constructor(e){super(e),this.traversalCost=e.traversalCost,this.elevation=e.elevation,this.texture=e.texture}getTraversalCost(){return this.traversalCost}getElevation(){return this.elevation}render(e,t){let n=k.instance.c;n.save(),n.translate(0,0),n.drawImage(this.texture,e,t),n.restore()}}const C=new v({name:"grass",traversalCost:1,elevation:0,texture:b(a("h9utD"))}),E=new v({name:"grassHill",traversalCost:1/0,elevation:1,texture:b(a("fhysK"))}),A=new v({name:"waterShallow",traversalCost:1/0,elevation:-1,texture:b(a("8uhqy"))}),M=new v({name:"waterDeep",traversalCost:1/0,elevation:-2,texture:b(a("3LBcK"))}),D=(new v({name:"ancientMech",traversalCost:1/0,elevation:1,texture:b(a("kENkU"))}),.5*(Math.sqrt(3)-1)),H=(3-Math.sqrt(3))/6,L=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,F=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),P=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class B{constructor(e=Math.random){const t="function"==typeof e?e:function(e){let t=0,n=0,i=0,a=1;const s=function(){let e=4022871197;return function(t){t=t.toString();for(let n=0;n<t.length;n++){e+=t.charCodeAt(n);let i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=4294967296*i}return 2.3283064365386963e-10*(e>>>0)}}();t=s(" "),n=s(" "),i=s(" "),t-=s(e),t<0&&(t+=1);n-=s(e),n<0&&(n+=1);i-=s(e),i<0&&(i+=1);return function(){const e=2091639*t+2.3283064365386963e-10*a;return t=n,n=i,i=e-(a=0|e)}}(e);this.p=function(e){const t=new Uint8Array(256);for(let e=0;e<256;e++)t[e]=e;for(let n=0;n<255;n++){const i=n+~~(e()*(256-n)),a=t[n];t[n]=t[i],t[i]=a}return t}(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(e,t){const n=this.permMod12,i=this.perm;let a=0,s=0,r=0;const o=(e+t)*D,l=Math.floor(e+o),c=Math.floor(t+o),h=(l+c)*H,d=e-(l-h),p=t-(c-h);let m,g;d>p?(m=1,g=0):(m=0,g=1);const y=d-m+H,u=p-g+H,w=d-1+2*H,f=p-1+2*H,x=255&l,T=255&c;let b=.5-d*d-p*p;if(b>=0){const e=3*n[x+i[T]];b*=b,a=b*b*(F[e]*d+F[e+1]*p)}let k=.5-y*y-u*u;if(k>=0){const e=3*n[x+m+i[T+g]];k*=k,s=k*k*(F[e]*y+F[e+1]*u)}let S=.5-w*w-f*f;if(S>=0){const e=3*n[x+1+i[T+1]];S*=S,r=S*S*(F[e]*w+F[e+1]*f)}return 70*(a+s+r)}noise3D(e,t,n){const i=this.permMod12,a=this.perm;let s,r,o,l;const c=.3333333333333333*(e+t+n),h=Math.floor(e+c),d=Math.floor(t+c),p=Math.floor(n+c),m=.16666666666666666*(h+d+p),g=e-(h-m),y=t-(d-m),u=n-(p-m);let w,f,x,T,b,k;g>=y?y>=u?(w=1,f=0,x=0,T=1,b=1,k=0):g>=u?(w=1,f=0,x=0,T=1,b=0,k=1):(w=0,f=0,x=1,T=1,b=0,k=1):y<u?(w=0,f=0,x=1,T=0,b=1,k=1):g<u?(w=0,f=1,x=0,T=0,b=1,k=1):(w=0,f=1,x=0,T=1,b=1,k=0);const S=g-w+.16666666666666666,R=y-f+.16666666666666666,v=u-x+.16666666666666666,C=g-T+.3333333333333333,E=y-b+.3333333333333333,A=u-k+.3333333333333333,M=g-1+.5,D=y-1+.5,H=u-1+.5,L=255&h,U=255&d,P=255&p;let B=.6-g*g-y*y-u*u;if(B<0)s=0;else{const e=3*i[L+a[U+a[P]]];B*=B,s=B*B*(F[e]*g+F[e+1]*y+F[e+2]*u)}let I=.6-S*S-R*R-v*v;if(I<0)r=0;else{const e=3*i[L+w+a[U+f+a[P+x]]];I*=I,r=I*I*(F[e]*S+F[e+1]*R+F[e+2]*v)}let _=.6-C*C-E*E-A*A;if(_<0)o=0;else{const e=3*i[L+T+a[U+b+a[P+k]]];_*=_,o=_*_*(F[e]*C+F[e+1]*E+F[e+2]*A)}let K=.6-M*M-D*D-H*H;if(K<0)l=0;else{const e=3*i[L+1+a[U+1+a[P+1]]];K*=K,l=K*K*(F[e]*M+F[e+1]*D+F[e+2]*H)}return 32*(s+r+o+l)}noise4D(e,t,n,i){const a=this.perm;let s,r,o,l,c;const h=(e+t+n+i)*L,d=Math.floor(e+h),p=Math.floor(t+h),m=Math.floor(n+h),g=Math.floor(i+h),y=(d+p+m+g)*U,u=e-(d-y),w=t-(p-y),f=n-(m-y),x=i-(g-y);let T=0,b=0,k=0,S=0;u>w?T++:b++,u>f?T++:k++,u>x?T++:S++,w>f?b++:k++,w>x?b++:S++,f>x?k++:S++;const R=T>=3?1:0,v=b>=3?1:0,C=k>=3?1:0,E=S>=3?1:0,A=T>=2?1:0,M=b>=2?1:0,D=k>=2?1:0,H=S>=2?1:0,F=T>=1?1:0,B=b>=1?1:0,I=k>=1?1:0,_=S>=1?1:0,K=u-R+U,N=w-v+U,J=f-C+U,z=x-E+U,O=u-A+2*U,$=w-M+2*U,q=f-D+2*U,W=x-H+2*U,Y=u-F+3*U,j=w-B+3*U,X=f-I+3*U,G=x-_+3*U,V=u-1+4*U,Z=w-1+4*U,Q=f-1+4*U,ee=x-1+4*U,te=255&d,ne=255&p,ie=255&m,ae=255&g;let se=.6-u*u-w*w-f*f-x*x;if(se<0)s=0;else{const e=a[te+a[ne+a[ie+a[ae]]]]%32*4;se*=se,s=se*se*(P[e]*u+P[e+1]*w+P[e+2]*f+P[e+3]*x)}let re=.6-K*K-N*N-J*J-z*z;if(re<0)r=0;else{const e=a[te+R+a[ne+v+a[ie+C+a[ae+E]]]]%32*4;re*=re,r=re*re*(P[e]*K+P[e+1]*N+P[e+2]*J+P[e+3]*z)}let oe=.6-O*O-$*$-q*q-W*W;if(oe<0)o=0;else{const e=a[te+A+a[ne+M+a[ie+D+a[ae+H]]]]%32*4;oe*=oe,o=oe*oe*(P[e]*O+P[e+1]*$+P[e+2]*q+P[e+3]*W)}let le=.6-Y*Y-j*j-X*X-G*G;if(le<0)l=0;else{const e=a[te+F+a[ne+B+a[ie+I+a[ae+_]]]]%32*4;le*=le,l=le*le*(P[e]*Y+P[e+1]*j+P[e+2]*X+P[e+3]*G)}let ce=.6-V*V-Z*Z-Q*Q-ee*ee;if(ce<0)c=0;else{const e=a[te+1+a[ne+1+a[ie+1+a[ae+1]]]]%32*4;ce*=ce,c=ce*ce*(P[e]*V+P[e+1]*Z+P[e+2]*Q+P[e+3]*ee)}return 27*(s+r+o+l+c)}}var I=B;class _{constructor(e,t){this.simplex=new I,this.width=e,this.height=t,this.content=[];for(let n=0;n<e*t;n++)this.content.push(C)}randomize(e){for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){Math.random()<e&&this.setFromXY(n,t,E)}}randomize2(e=0){let t=this.height,n=this.width,i=9+Math.random(),a=2.5+2*Math.random(),s=2/64+6/64*Math.random(),r=i+1.5*Math.random(),o=.5+1.5*Math.random(),l=s+.125*Math.random(),c=.125;for(let e=0;e<n;e++)for(let h=0;h<t;h++){let d=Math.hypot(h-t/2,e-n/2),p=[i,0],m=[r,0];if(0!=d){let a=h-t/2,s=e-n/2;a*=i/d,s*=i/d,a+=t/2,s+=n/2,p=[s,a];let o=h-t/2,l=e-n/2;o*=r/d,l*=r/d,o+=t/2,l+=n/2,m=[l,o]}let g=i+a*this.simplex.noise2D(p[0]*s,p[1]*s),y=r+o*this.simplex.noise2D(m[0]*l,m[1]*l);Math.hypot(e-n/2,h-t/2)>y&&Math.hypot(e-n/2,h-t/2)>g?this.setFromXY(e,h,M):Math.hypot(e-n/2,h-t/2)>g?this.setFromXY(e,h,A):this.simplex.noise2D(e*c,h*c)>.5?this.setFromXY(e,h,E):this.simplex.noise2D(e*c,h*c)<-.7?this.setFromXY(e,h,A):this.setFromXY(e,h,C)}}clearUnitPaths(){let{width:e,height:t}=this,n=new d(4,4),i=new d(3,3);this.fillRect(i,n,C),this.fillRect(new d(e,t).subtract(n).subtract(i),n,C);let a=new d(e,t).subtract(i);for(let e=i.x;e<a.x||e<a.y;e++){let t=new d(e,e),n=new d(e+1,e);this.set(t,C),this.set(n,C)}}newMap(){this.randomize2(0),this.clearUnitPaths()}placeUnits(e){for(let t=0;t<e.length;t++)0==e[t].teamNumber?this.placeUnit(e,e[t],!0):this.placeUnit(e,e[t],!1)}placeUnit(e,t,n){let i=0;n&&(i=this.height+this.width);for(let a=0;a<this.height;a++)for(let s=0;s<this.width;s++){let r=!1;e.forEach((e=>{e.pos.x==s&&e.pos.y==a&&(r=!0)})),(n?s+a<i:s+a>i)&&!r&&this.getFromXY(s,a).getTraversalCost()<1/0&&(i=s+a,t.pos.x=s,t.pos.y=a)}}set(e,t){this.setFromXY(e.x,e.y,t)}setFromXY(e,t,n){t>=this.height||e>=this.width?console.error("Tried setting tile out of grid bounds."):this.content[t*this.width+e]=n}get(e){return this.getFromXY(e.x,e.y)}getFromXY(e,t){return this.content[t*this.width+e]}fillRect(e,t,n){let i=Math.max(0,e.x),a=Math.max(0,e.y),s=Math.min(e.x+t.x,this.width),r=Math.min(e.y+t.y,this.height);for(let e=a;e<r;e++)for(let t=i;t<s;t++)this.setFromXY(t,e,n)}contains(e){return e.y>=0&&e.x>=0&&e.x<this.width&&e.y<this.height}isEmpty(e){return this.get(e).getTraversalCost()<1/0}getElevation(e){return this.get(e)?.getElevation()??0}}const K=[[new d(1,0),new d(-1,0),new d(0,1),new d(0,-1)],[new d(0,1),new d(0,-1),new d(1,0),new d(-1,0)]];function N(e,t=!1){return t?[new d(1,0),new d(-1,0),new d(0,1),new d(0,-1),new d(1,1),new d(-1,1),new d(-1,-1),new d(1,-1)]:K[e]}function J(e,t,n,i=100){function a(e,t){return{pos:e,parent:t}}function s(e){let t=[e.pos];for(;null!=e.parent;)e=e.parent,t.push(e.pos);return t.reverse()}if(t.equals(n))return[t];if(!e.isWalkable(n))return null;let r=n.toString(),o=[a(t,null)],l=[],c=new Set;c.add(t.toString());for(let t=0;t<i;t++){for(let t of o){let n=N((t.pos.x+t.pos.y)%2);for(let i of n){let n=t.pos.add(i);if(!e.isWalkable(n))continue;if(Math.abs(i.x)>0&&Math.abs(i.y)>0){let n=e.isWalkable(t.pos.addXY(i.x,0)),a=e.isWalkable(t.pos.addXY(0,i.y));if(!n&&!a)continue}let o=n.toString();if(c.has(o))continue;c.add(o);let h=a(n,t);if(o==r)return s(h);l.push(h)}}let t=o;o=l,l=t,l.length=0}return null}class z{static node(e){let t=z.openNode;return t&&(t.children||(t.children=[]),Array.isArray(t.children)&&t.children.push(e),e.parent=t),z.openNode=e,e.content&&e.content(),z.openNode=e.parent,e}static render(e,t,n=!1){let{m11:i,m12:a,m13:s,m21:r,m22:o,m23:l}=t.localMatrix;if(e.save(),e.transform(i,r,a,o,s,l),t.onRender&&t.onRender(t),n&&null!=t.rect&&null!=t.debugColor&&(e.globalAlpha=.25,e.fillStyle=t.debugColor,e.fillRect(0,0,t.rect.width,t.rect.height),e.globalAlpha=1),t.children)for(let i of t.children)z.render(e,i,n);t.onRenderPost&&t.onRenderPost(t),e.restore()}static pickNode(e,t){return z.pick(e,t).node}static pick(e,t){let n,i=t;return function e(t,a){let s=t.localMatrix.inverse().multiplyVec(a);if(t.rect){let e=t.rect;l(0,e.width,s.x)&&l(0,e.height,s.y)&&(n=t,i=s)}if(t.children)for(let n of t.children)e(n,s)}(e,t),{node:n,point:i}}static addParentReferences(e,t){if(e.parent=t,e.children)for(let t of e.children)z.addParentReferences(t,e)}static relativeMatrix(e,t){let n=e.localMatrix;for(;e.parent&&e!=t;)n=e.parent.localMatrix.multiply(n),e=e.parent;return n}static globalMatrix(e){return z.relativeMatrix(e)}static toLocalSpace(e,t,n){return z.relativeMatrix(t,n).inverse().multiplyVec(e)}}class O{constructor(e,t,n=!1,i){this.selectedUnitIndex=-1,this.units=[],this.playable=!0,this.scene={localMatrix:p.identity},this.units=t,this.name=e,this.flipUnits=n}get length(){return this.units.length}get hasUnitSelected(){return this.selectedUnitIndex>-1}setUnitIndex(e){e!=this.selectedUnitIndex&&St.instance.match.cardTray.deselect(),this.selectedUnitIndex=e}deselect(){this.setUnitIndex(-1)}toggleSelectIndex(e){this.hasUnitSelected&&e==this.selectedUnitIndex?(this.deselect(),St.instance.match.cardTray.deselect()):this.setUnitIndex(e)}toggleSelectUnit(e){let t=this.units.indexOf(e);this.toggleSelectIndex(t)}cycleUnits(){this.hasUnitSelected?this.setUnitIndex((this.selectedUnitIndex+1)%this.length):this.setUnitIndex(0)}selectUnit(e){let t=this.units.indexOf(e);t>-1&&this.setUnitIndex(t)}selectedUnit(){let e=this.units;if(this.hasUnitSelected)return e[this.selectedUnitIndex]}getUnit(e){for(let t of this.units)if(t.pos.equals(e))return t}endTurn(){this.units.forEach((e=>{e.speed=e.maxSpeed})),this.deselect()}startTurn(){this.units.forEach((e=>{e.energy=e.maxEnergy,e.statCap()})),this.deselect()}update(){this.units=this.units.filter((e=>e.health>0));for(let e of this.units)e.update()}}const $=b(a("gb6Jt")),q=(b(a("fSjwC")),b(a("jPL73"))),W=b(a("eOAT7")),Y=b(a("ckBlf")),j=b(a("11iVL")),X=b(a("j8ho2")),G=b(a("gqipq")),V=b(a("6ftts")),Z=b(a("3bAft")),Q=b(a("eK07Y")),ee=b(a("6apJ1")),te=b(a("cShrF")),ne=b(a("6i3cT")),ie=b(a("3yIQk")),ae=b(a("gqAfu")),se=b(a("3QXkh")),re=b(a("2FSE5")),oe=b(a("60iqD")),le=b(a("eLkWC")),ce=b(a("llwLD")),he=b(a("e5RPM")),de=b(a("36AKi")),pe=b(a("5umeh")),me=b(a("lS59Y")),ge=b(a("1nBTg")),ye=b(a("tpHuI")),ue=b(a("blSrT")),we=b(a("bJEKW")),fe=b(a("6U9tT")),xe=b(a("OIsvx")),Te=(b(a("kMkUa")),b(a("j7Onr"))),be=b(a("emB6h")),ke=b(a("9QqEy")),Se=(b(a("5hfr4")),b(a("Wkcxi"))),Re=(b(a("lfCUM")),b(a("fw68x"))),ve=b(a("afCUm")),Ce=b(a("30jZt")),Ee=b(a("5HLz4")),Ae=(b(a("fhysK")),b(a("cwVfH"))),Me={laser:{name:"Laser",getDescription:e=>`Deal ${e.type.damage} damage, Take 1 damage`,color:"#969696",sprite:q,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range}),onApplyToTile:(e,t,n,i)=>{i?.addHealth(-e.type.damage),t.addHealth(-1)},render:(e,t,n)=>{let i=k.instance,a=32,s=St.instance.match.getUnit(n);if(s){let n=t.pos.scale(a).add(new d(16,16)),r=s.pos.scale(a).add(new d(16,16));i.c.strokeStyle="rgba(255, 0, 0, 1)",i.c.lineWidth=20*Math.cos(e),i.c.beginPath(),i.c.moveTo(n.x,n.y),i.c.lineTo(r?.x,r?.y),i.c.stroke()}},renderFrames:10,cost:1,damage:6,range:8,minDist:2,friendly:!1},energyArmor:{name:"Energy Armor",getDescription:e=>`Block ${e.type.damage} damage while in hand, -Draw 1 card, -Exhaustive`,color:"#6BB5FF",sprite:W,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{t.drawCard(1)},cost:0,damage:2,range:0,minDist:0,friendly:!0,exhaustive:!0},shieldCharge:{name:"Shield Charge",getDescription:e=>`Generate ${e.type.damage} Energy Armor`,color:"#6BB5FF",sprite:Y,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{t.gainCard(Me.energyArmor,e.type.damage)},cost:1,damage:2,range:0,minDist:0,friendly:!0},coreCharge:{name:"Core Charge",getDescription:e=>`Gain ${e.type.count} Fuel Card`,color:"#6BB5FF",sprite:Y,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{t.draw.add(Me.fuel,e.type.count)},cost:1,damage:0,range:0,minDist:0,friendly:!0,count:1},energyFist:{name:"Energy Fist",getDescription:e=>`Deal ${e.type.damage} damage, knockback target ${e.type.minDist} tiles`,color:"#6BB5FF",sprite:j,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range}),onApplyToTile:(e,t,n,i)=>{let a=St.instance.match;if(i?.addHealth(-e.type.damage),i){let s=Ue(i.pos,n.subtract(t.pos).unit(),{range:e.type.minDist,ignoreObstacles:!1}).pop();s&&a.map.contains(s)&&(i.pos=s)}},cost:1,damage:6,range:1,minDist:3,friendly:!1},barrier:{name:"Phase Shift",getDescription:e=>`Move ${e.type.range} in any direction, Ignores obstacles`,color:"#6BB5FF",sprite:X,backing:Ce,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range,ignoreObstacles:!0}),onApplyToTile(e,t,n,i){t.pos=n},cost:0,damage:0,range:1,minDist:1,friendly:!1,mobile:!0},bouldertoss:{name:"Boulder Toss",getDescription:e=>`Deal ${e.type.damage} damage, -Creates Mountain`,color:"#b87420",sprite:G,backing:Re,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{St.instance.match.map.set(n,E),i?.addHealth(-e.type.damage)},render:(e,t,n)=>{let i=k.instance,a=(St.instance.match,new d(16,16)),s=n.scale(32);i.drawSheetFrame(Ae,32,s.x,s.y,0);let r=new d(0,-20),o=t.pos.lerp(n,e).scale(32).add(r),l=new d(0,20*-Math.sin(e*Math.PI));for(let e=0;e<5;e++){let t=new d(8*Math.sin(e),8*Math.cos(e)),n=o.add(t).add(l).add(a);i.fillCircle(n,10,`rgba(${15*e}, 0, 0, 1)`)}},renderFrames:25,cost:1,damage:3,range:5,minDist:2,friendly:!1},plateShift:{name:"Plate Shift",getDescription:e=>`Drop ${e.type.dim.x}x${e.type.dim.y} Mountains`,color:"#b87420",sprite:Z,backing:Re,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range}),onApplyToTile:(e,t,n,i)=>{St.instance.match.map.set(n,E)},getTilesEffected(e,t){St.instance.match;let n=[t],i=this.dim;for(let e=0;e<i.x;e++)for(let a=0;a<i.y;a++){let i=t.add(new d(e-1,a-1));i.equals(t)||n.push(i)}return n},cost:1,damage:0,dim:new d(3,3),range:3,minDist:3,friendly:!1},mine:{name:"Mine",getDescription:e=>`Deal ${e.type.damage} damage, Gain 1 FUEL, -Clears Mountains`,color:"#b87420",sprite:V,backing:Re,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range,ignoreObstacles:!0,ignoreElevation:!0}),onApplyToTile:(e,t,n,i)=>{let a=St.instance.match;if(a.map.get(n)==E){a.map.set(n,C);let e=new Be;e.type=Me.fuel,t.draw.cards.push(e)}i?.addHealth(-e.type.damage)},cost:1,damage:6,range:1,minDist:1,friendly:!1},fuel:{name:"Fuel",getDescription:e=>`Gain ${e.type.damage} energy, -Exhaustive`,color:"#aaaaaa",sprite:$,backing:Re,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i?.addEnergy(e.type.damage),t?.addEnergy(-e.type.cost),t.discard.cards.pop()},cost:0,damage:1,range:1,minDist:0,friendly:!0,exhaustive:!0},gorge:{name:"Gorge",getDescription:e=>`Charge through a line of Mountains, Deal ${e.type.damage} damage`,color:"#b87420",sprite:Q,backing:Re,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range,ignoreObstacles:!1,ignoreElevation:!1,passable:(e,t)=>!(e.map.getElevation(t)<0)}),getTilesEffected(e,t){let n=St.instance.match,i=[t],a=(this.dim,e.pos.subtract(t));for(let t=0;t<a.length;t++){let s=a.unit(),r=e.pos.subtract(s.scale(t));r=new d(Math.round(r.x),Math.round(r.y)),!r.equals(e.pos)&&n.map.contains(r)&&i.push(r)}return i},onApplyToTile:(e,t,n,i)=>{let a=St.instance.match;a.map.get(n)==E&&a.map.set(n,C),i&&i!==t&&i?.addHealth(-e.type.damage),t.pos=n},cost:1,damage:3,range:5,minDist:1,friendly:!1},dynamite:{name:"Dynamite",getDescription:e=>`Deal ${e.type.damage} damage, in a ${e.type.dim?.x}x${e.type.dim?.y} area -Clears Mountains`,color:"#b87420",sprite:ee,backing:Re,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{let a=St.instance.match;1==a.map.getElevation(n)&&a.map.set(n,C),i&&i?.addHealth(-e.type.damage)},getTilesEffected(e,t){St.instance.match;let n=[t],i=this.dim;for(let e=0;e<i.x;e++)for(let a=0;a<i.y;a++){let i=t.add(new d(e-1,a-1));i.equals(t)||n.push(i)}return n},cost:1,damage:3,dim:new d(3,3),range:5,minDist:2,friendly:!1},plating:{name:"Plating",getDescription:e=>`Reduce inbound damage by ${e.type.damage}`,color:"#b87420",sprite:te,backing:Re,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),damage:1,range:0,minDist:1,friendly:!1},exhaustPorts:{name:"Exhaust Ports",getDescription:e=>`draw ${e.type.drawCount}`,color:"#b87420",sprite:te,backing:Re,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile(e,t,n,i){t.drawCard(e.type.drawCount)},healthCost:2,drawCount:2,damage:1,range:0,minDist:0,friendly:!1},claw:{name:"Claw",getDescription:e=>`Deal ${e.type.damage} damage, -Exhaustive`,color:"#af0000",sprite:ne,backing:Se,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i&&i.addHealth(-e.type.damage)},cost:0,damage:3,range:1,minDist:1,friendly:!1,exhaustive:!0},frenzy:{name:"Frenzy",getDescription:e=>`-Generate ${e.type.damage} Claw, -Draw ${e.type.drawCount} cards`,color:"#af0000",sprite:ie,backing:Se,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{for(let n=0;n<e.type.damage;n++){let e=new Be;e.type=Me.claw,t.draw.insertAtRandom(e)}t.drawCard(2)},cost:1,drawCount:2,damage:2,range:0,minDist:0,friendly:!0},leap:{name:"Leap",getDescription:e=>"Leap to a tile within range, -Ignore Obstacles",color:"#af0000",sprite:ae,backing:Se,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{St.instance.match.map.contains(n)&&(t.pos=n)},cost:1,damage:0,range:7,minDist:5,friendly:!1},lump:{name:"Lump",getDescription:e=>`Gain ${e.type.damage} HP,     Draw ${e.type.drawCount} Card, -Exhaustive`,color:"#af0000",sprite:se,backing:Se,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{t.addHealth(e.type.damage),t.drawCard(e.type.drawCount)},cost:0,damage:4,maxHp:5,energy:1,drawCount:1,range:0,minDist:0,friendly:!1,exhaustive:!0},sentience:{name:"Sentience",getDescription:e=>`Draw ${e.type.drawCount} Cards`,color:"#af0000",sprite:le,backing:Se,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{t.drawCard(e.type.drawCount)},healthCost:3,damage:4,drawCount:3,range:0,minDist:0,friendly:!1},chomp:{name:"Chomp",getDescription:e=>`Deal ${e.type.damage} damage,\n         -Gain ${e.type.maxHp} MaxHP`,color:"#af0000",sprite:re,backing:Se,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range}),onApplyToTile:(e,t,n,i)=>{i&&(t.addMaxHealth(e.type.maxHp),i.addHealth(-e.type.damage))},cost:1,damage:4,drawCount:1,maxHp:1,range:2,minDist:0,friendly:!1},acid:{name:"Acid Spit",getDescription:e=>`Discard a random card, Deal ${e.type.damage} damage`,color:"#af0000",sprite:oe,backing:Se,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{if(t.hand.length>0){let e=r(t.hand.length);t.discardCardAt(e)}i&&i.addHealth(-e.type.damage)},cost:1,damage:5,range:5,minDist:2,friendly:!1},bloodClot:{name:"Blood Clot",getDescription:e=>`Heal ${e.type.heal} HP`,color:"#af0000",sprite:le,backing:Se,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile(e,t,n,i){t.addHealth(e.type.heal)},cost:0,heal:2,damage:0,range:0,minDist:0,friendly:!1},repair:{name:"Repair-Kit",getDescription:e=>`Heal unit for ${e.type.damage} health`,color:"#32a852",sprite:he,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i?.addHealth(e.type.damage),t.discard.cards.pop()},render:(e,t,n)=>{let i=k.instance,a=St.instance.match.getUnit(n);if(a){let t=a.pos.scale(32).add(new d(16,16)),n=`rgba(0, 255, 0, ${e})`;i.fillCircle(t,Math.abs(32*Math.sin(e*Math.PI*6)*.8),n),console.log("drawing repair!")}},renderFrames:40,cost:0,damage:7,range:1,minDist:0,friendly:!0,exhaustive:!0},sprint:{name:"Sprint",getDescription:e=>`Take ${e.type.damage} damage,\n         Gain ${e.type.range} speed,\n         Gain ${e.type.cost} Energy`,color:"#667799",sprite:ce,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i&&(t.addHealth(-e.type.damage),i.addEnergy(e.type.cost),i.addSpeed(e.type.range)),console.log(t.discard.cards.pop())},cost:1,damage:3,range:1,minDist:0,friendly:!0,exhaustive:!0},rifle:{name:"Rifle",getDescription:e=>`Deal ${e.type.damage} damage to target`,color:"#969696",sprite:pe,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Fe(t.pos,{range:e.type.range}),onApplyToTile:(e,t,n,i)=>{i?.addHealth(-e.type.damage)},render:(e,t,n)=>{let i=k.instance,a=32,s=St.instance.match.getUnit(n);if(s){let n=t.pos.scale(a).add(new d(16,16)),r=s.pos.scale(a).add(new d(16,16)),o={pos:n.lerp(r,e),radius:2,color:"rgba(50, 0, 0)"};for(let e=0;e<5;e++){let e=4,t=new d(Math.random()*e,Math.random()*e);i.fillCircle(o.pos.add(t),o.radius,o.color)}}},renderFrames:4,cost:1,damage:4,range:3,minDist:2,friendly:!1},grapplingHook:{name:"Grappling Hook",getDescription:e=>`Pull you to target from ${e.type.range} tiles away.`,color:"#969696",sprite:de,backing:Ce,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{if(i){let e=i.pos.x<t.pos.x?i.pos.x+1:i.pos.x==t.pos.x?i.pos.x:i.pos.x-1,n=i.pos.y<t.pos.y?i.pos.y+1:i.pos.y==t.pos.y?i.pos.y:i.pos.y-1,a=new d(e,n),s=[t.pos,a];t.move(s)}},cost:1,damage:0,range:8,minDist:1,friendly:!1},perfume:{name:"Perfume",getDescription:e=>`Reduce MaxHP by ${e.type.damage}, increase Speed by ${e.type.damage}`,color:"#026822",sprite:me,backing:ve,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i&&(i.speed+=e.type.damage,i.addMaxHealth(-e.type.damage))},cost:1,damage:2,range:6,minDist:0,friendly:!1},root:{name:"Root",getDescription:e=>`Immobilize Target Target Heals ${e.type.damage} HP`,color:"#026822",sprite:ye,backing:ve,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i&&(i.speed=1,i.addHealth(e.type.damage))},cost:1,damage:8,range:6,minDist:0,friendly:!1},fungus:{name:"Fungus",getDescription:e=>`Target Gains ${e.type.energy} Energy`,color:"#026822",sprite:fe,backing:ve,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i&&i.addEnergy(e.type.energy)},speedCost:2,energy:1,damage:8,range:4,minDist:0,friendly:!1},flower:{name:"Flower",getDescription:e=>`Grant Target ${e.type.damage} Fruits`,color:"#026822",sprite:ue,backing:ve,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i&&i.draw.add(Me.fruit,2)},cost:1,damage:2,range:4,minDist:0,friendly:!1},fruit:{name:"Fruit",getDescription:e=>`Grant User ${e.type.damage} HP -Exhaustive`,color:"#026822",sprite:ge,backing:ve,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{i?.addHealth(e.type.damage)},cost:0,damage:2,range:1,minDist:0,friendly:!0,exhaustive:!0},bark:{name:"Bark",getDescription:e=>`Heal a target for ${e.type.heal} HP`,color:"#026822",sprite:we,backing:ve,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile(e,t,n,i){i?.addHealth(e.type.heal)},speedCost:2,damage:0,heal:3,range:2,minDist:0,friendly:!1},boomShroom:{name:"BoomShroom",getDescription:e=>`Reduce MaxHP: ${e.type.damage} in a ${e.type.dim?.x}x${e.type.dim?.y} area -Clears Mountains`,color:"#026822",sprite:xe,backing:ve,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{let a=St.instance.match;1==a.map.getElevation(n)&&a.map.set(n,C),i&&i?.addMaxHealth(-e.type.damage)},getTilesEffected(e,t){St.instance.match;let n=[t],i=this.dim;for(let e=0;e<i.x;e++)for(let a=0;a<i.y;a++){let i=t.add(new d(e-1,a-1));i.equals(t)||n.push(i)}return n},cost:1,damage:3,dim:new d(3,3),range:5,minDist:2,friendly:!1},tentacle:{name:"Tentacle Pull",getDescription:e=>`Pull target to you from ${e.type.range} tiles away.`,color:"#990099",sprite:be,backing:Ee,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{if(i){let e=t.pos.x<i.pos.x?t.pos.x+1:t.pos.x==i.pos.x?t.pos.x:t.pos.x-1,n=t.pos.y<i.pos.y?t.pos.y+1:t.pos.y==i.pos.y?t.pos.y:t.pos.y-1,a=new d(e,n),s=[i.pos,a];i.move(s)}},cost:1,damage:0,range:6,minDist:1,friendly:!1},bubbletoss:{name:"Bubble Toss",getDescription:e=>`Create shallow water, Deal ${e.type.damage} damage`,color:"#990099",sprite:Te,backing:Ee,canApplyToEmptyTiles:!0,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{St.instance.match.map.set(n,A),i?.addHealth(-e.type.damage)},cost:1,damage:2,range:5,minDist:2,friendly:!1},warp:{name:"Wrong Warp",getDescription:e=>`Swap places with target, Gain ${e.type.damage} Wrong Warp`,color:"#990099",sprite:ke,backing:Ee,canApplyToEmptyTiles:!1,getTilesInRange:(e,t)=>Pe(t.pos,e.type.minDist,e.type.range),onApplyToTile:(e,t,n,i)=>{if(i){let n=i.pos;i.pos=t.pos,t.pos=n,t.discard.add(e.type,e.type.damage)}},cost:1,damage:1,range:6,minDist:2,friendly:!1}};var De=Me;const He=Object.values(Me);function Le(){let e=Math.floor(Math.random()*He.length);return He[e]}function Ue(e,t,{range:n=1/0,ignoreObstacles:i=!1,ignoreElevation:a=!1,result:s=[],passable:r}){let o=St.instance.match;o.map.getElevation(e);null==r&&(r=(e,t)=>i||e.isWalkable(t,!1));for(let i=1;i<=n;i++){let n=e.add(t.scale(i)),a=o.map.contains(n);o.getUnit(n);if(!a||!r(o,n))break;let l=!1;s.forEach(((e,t)=>{n.equals(e)&&(l=!0)})),l||s.push(n)}return s}function Fe(e,{range:t=1/0,ignoreObstacles:n=!1,ignoreElevation:i=!1,result:a=[],passable:s}){return Ue(e,new d(1,0),{range:t,ignoreObstacles:n,result:a,passable:s}),Ue(e,new d(-1,0),{range:t,ignoreObstacles:n,result:a,passable:s}),Ue(e,new d(0,1),{range:t,ignoreObstacles:n,result:a,passable:s}),Ue(e,new d(0,-1),{range:t,ignoreObstacles:n,result:a,passable:s}),a}function Pe(e,t,n,i=[]){for(let a=-n;a<=n;a++)for(let s=-n;s<=n;s++){let r=Math.abs(a)+Math.abs(s);r>=t&&r<=n&&i.push(e.addXY(a,s))}return i}class Be{constructor(e){this.yRotation=0,this.pos=new d(0,0),this.color="#"+[256*Math.random()|0,256*Math.random()|0,256*Math.random()|0].map((e=>e.toString(16).padStart(2,"0"))).join(""),this.type=De.laser,this.type=e||Le()}render(){let e=k.instance,{color:t,backing:n,sprite:i,name:a}=this.type,s=Math.cos(-this.yRotation);if(e.vTranslate(Be.dimensions.scale(.5)),e.c.scale(s,1),e.vTranslate(Be.dimensions.scale(-.5)),this.yRotation>=Math.PI/2)e.strokeRect(new d(0,0),Be.dimensions,"#ffddff"),e.drawRect(new d(0,0),Be.dimensions,t);else{e.c.drawImage(n,0,0,Be.dimensions.x,Be.dimensions.y,0,0,Be.dimensions.x,Be.dimensions.y),e.c.drawImage(i,0,0,Be.dimensions.x,Be.dimensions.y,7,7,.75*Be.dimensions.x,.75*Be.dimensions.y),e.drawRect(new d(0,0),new d(Be.dimensions.x,8),t),e.setFont(5,"pixel2"),e.drawText(new d(3,1),a,"#f0ead8");let s={dim:new d(10,10),pos:new d(0,7),green:{dark:"rgb(30, 125, 30)",light:"rgb(0, 240, 0)"},red:{light:"rgb(255, 0, 0)",dark:"rgb(100, 0, 0)"},blue:{light:"rgb(100, 100, 255)",dark:"rgb(0, 0, 75)"},index:0};if((this.type.cost||this.type.healthCost||this.type.speedCost)&&e.drawRect(s.pos,s.dim,this.type.color),void 0!==this.type.cost&&(e.costDisplay(s.pos,this.type.cost,s.green.light,s.green.dark,Be.dimensions.x/6),s.index+=1),void 0!==this.type.healthCost){let t=new d(s.dim.x,0),n=s.index>0?s.pos.add(t):s.pos;e.costDisplay(n,this.type.healthCost,s.red.light,s.red.dark,Be.dimensions.x/6),s.index+=1}if(void 0!==this.type.speedCost){let t=new d(0,s.dim.y),n=s.index>0?s.pos.add(t):s.pos;e.costDisplay(n,this.type.speedCost,s.blue.light,s.blue.dark,Be.dimensions.x/6)}e.drawRect(new d(4,40),new d(40,20),this.type.color),Ie(this.type.getDescription(this),17).forEach(((t,n)=>{e.setFont(5,"ariel"),e.drawText(new d(6,42+4*n),t,"#f0ead8")}))}}getTilesInRange(e){return this.type.getTilesInRange(this,e)}apply(e,t){const n=this.type,i=(n.dim,St.instance.match);let a=i.getUnit(t);n.onApplyToTile&&(n.getTilesEffected&&n.getTilesEffected(e,t).forEach(((t,s)=>{a=i.getUnit(t),n.onApplyToTile(this,e,t,a)})),n.onApplyToTile(this,e,t,a)),void 0!==n.cost&&e.addEnergy(-n.cost),void 0!==n.healthCost&&e.addHealth(-n.healthCost),void 0!==n.speedCost&&e.addSpeed(-n.speedCost)}}function Ie(e,t){let n=e.split(" ");if(0==n.length)return[];let i=[],a=n[0];for(let e=1;e<n.length;e++){let s=n[e],r=a+" "+s;r.length>t?(i.push(a),a=s):a=r}return a.length>0&&i.push(a),i}Be.dimensions=new d(48,64);class _e{constructor(){this.index=-1,this.lastSelectTime=-1/0,this.isPickingTarget=!1}hasCardSelected(){return this.index>-1}selectedCard(e){return e?.hand.cards[this.index]}selectIndex(e){this.index=e,this.lastSelectTime=Date.now()}deselect(){this.selectIndex(-1),this.isPickingTarget=!1}onSelectUnit(e){this.deselect(),this.lerpCards(e,1);let{hand:t,draw:n,discard:i}=e,a=[t,n,i];for(let e of a)for(let t of e.cards)t.yRotation=Math.PI/2}update(e){let{lastSelectTime:t}=this,n=St.instance;if(this.lerpCards(e,.2),this.hasCardSelected()&&!this.isPickingTarget){Date.now()-t>_e.selectionTimeout&&n.match.playerTurn()&&this.selectIndex(-1)}}lerpCards(e,t){if(e){let{hand:n,draw:i,discard:a}=e;n.cards.forEach(((e,i)=>{let a=this.handPosition(n.length,i);e.pos=e.pos.lerp(a,t),e.yRotation=h(e.yRotation,0,.5*t)})),i.cards.forEach(((e,n)=>{let a=this.drawPosition(i.length,n);e.pos=e.pos.lerp(a,t),e.yRotation=h(e.yRotation,Math.PI,.5*t)})),a.cards.forEach(((e,n)=>{let i=this.discardPosition(a.length,n);e.pos=e.pos.lerp(i,t),e.yRotation=h(e.yRotation,Math.PI,.5*t)}))}}handBase(e){const t=_e.handMargin;let n=(Be.dimensions.x+t)*e-t,i=St.instance.screenDimensions();return new d(i.x/2-n/2,i.y-Be.dimensions.y+_e.restingDepth)}handPosition(e,t){const n=_e.handMargin;let i=Be.dimensions.x+n,a=t==this.index?_e.restingDepth:0;return this.handBase(e).addXY(i*t,-a)}drawPosition(e,t){let n=new d(.5,.5),i=St.instance.screenDimensions();n.x;return new d(0,i.y-Be.dimensions.y/2.5).addXY(t*n.x,t*n.y)}discardPosition(e,t){let n=new d(.5,.5),i=St.instance.screenDimensions(),a=n.x*e;return new d(i.x-Be.dimensions.x-a,i.y-Be.dimensions.y/2.5).addXY(t*n.x,t*n.y)}makeSceneNode(e){k.instance;let t=St.instance,n=e.hand,i=e.draw,a=e.discard;if(!n||!i||!a)return;const s=_e.handMargin;let r=(Be.dimensions.x+s)*n.length-s;z.node({description:"card-tray",localMatrix:p.vTranslation(this.handBase(n.length)),rect:{width:r,height:Be.dimensions.y}}),n.cards.forEach(((e,n)=>z.node({description:"card-hand",localMatrix:p.vTranslation(e.pos),rect:{width:Be.dimensions.x,height:Be.dimensions.y},onRender:()=>e.render(),onHover:()=>{t.match.playerTurn()&&!this.isPickingTarget&&this.selectIndex(n)},onClick:()=>{if(t.match.playerTurn()){let e=this.index==n;this.isPickingTarget&&e?this.deselect():(this.index=n,this.isPickingTarget=!0)}}}))),i.cards.forEach(((e,t)=>z.node({description:"card-draw",localMatrix:p.vTranslation(e.pos),rect:{width:Be.dimensions.x,height:Be.dimensions.y},onRender:()=>{e.render(),i.length}}))),a.cards.forEach(((e,t)=>z.node({description:"card-discard",localMatrix:p.vTranslation(e.pos),rect:{width:Be.dimensions.x,height:Be.dimensions.y},onRender:()=>{e.render(),a.length}})))}}_e.selectionTimeout=500,_e.restingDepth=24,_e.handMargin=3;class Ke{constructor(){this.index=-1,this.hasUnitSelected=!1}makeSceneNode(e,t,n=!1){let i=k.instance,a=t.units;z.node({description:"unit-tray",localMatrix:p.translation(e.x,e.y),content:()=>{a.forEach(((e,a)=>{const s=new d(32,32);let r=1.5,o=a==t.selectedUnitIndex?s.x*r:32,l=a==t.selectedUnitIndex?s.y*r:32,c=t.selectedUnitIndex<a&&-1!==t.selectedUnitIndex?17:0;z.node({description:e.name,localMatrix:p.translation(0,32*a+c),rect:{width:o,height:l},onRender:()=>{i.c.save(),n&&i.c.scale(-1,1),a==t.selectedUnitIndex&&i.c.scale(r,r);i.drawRect(new d(0,0),s,"rgba(100, 100, 100, 1)"),i.c.lineWidth=1,i.strokeRect(new d(0,0),s,"black"),e.render(!1),e.renderName(new d(0,19.5),"black","rgba(150, 150, 150, 0.7)"),e.drawStats(),i.c.restore()},onClick:()=>{St.instance.match.playerTurn()&&t.selectUnit(e)}})}))}})}}class Ne{constructor(e=8){this.delay=500,this.chodiness=0,this.maxChodiness=e}think(e){this.startTime=Date.now();let t=St.instance,{match:n}=t,{cardTray:i}=n;if(this.chodiness+=1,e.units.length>0&&e.selectedUnitIndex>-1&&n.teams[0].length>0){let t=e.selectedUnit(),n=i.selectedCard(t);if(n&&n.type.onApplyToTile){let e=this.idealSpot(t,n),i=this.getEnemiesOf(t);if(e&&!t.pos.equals(e))n.type.mobile?this.useCard(e):this.moveTowards(t,e);else if(i.length>0){let e=this.bestTargetOf(t,n);e&&this.useCard(e.pos)}}else this.selectBestCard(t)}}update(){this.startTime&&Date.now()-this.startTime>=this.delay&&(this.startTime=void 0)}active(){return null==this.startTime}reset(){this.chodiness=0,this.startTime=void 0}getEnemiesOf(e){let t=[];return St.instance.match.teams.forEach(((n,i)=>{i!==e.teamNumber&&n.units.forEach((e=>{t.push(e)}))})),t}getFriendsOf(e){let t=[];return St.instance.match.teams.forEach(((n,i)=>{i==e.teamNumber&&n.units.forEach((e=>{t.push(e)}))})),t}bestTargetOf(e,t){let n,i=this.possibleTargets(e,t);return i.length>0&&i.forEach((e=>{(null==n||e.health<n.health)&&(n=e)})),n}closestTargetTo(e){let t;return this.getEnemiesOf(e).forEach((n=>{if(void 0!==t){let i=t.pos.distance(e.pos);n.pos.distance(e.pos)<i&&(t=n)}else t=n})),t}possibleTargets(e,t){St.instance;let n=t.type.getTilesInRange(t,e),i=[],a=this.getEnemiesOf(e),s=this.getFriendsOf(e);return n.forEach((e=>{t.type.friendly?s.forEach((t=>{e.x==t.pos.x&&e.y==t.pos.y&&i.push(t)})):a.forEach((t=>{e.x==t.pos.x&&e.y==t.pos.y&&i.push(t)}))})),i}selectBestCard(e){let t=St.instance,n=[];if(e.hand.cards.forEach((t=>{t.type.cost<=e.energy&&t.type.onApplyToTile&&n.push(t)})),n.length>0){let e=n[r(n.length)],i=t.match.selectedUnit().hand.cards.indexOf(e);t.match.cardTray.selectIndex(i)}}useCard(e){St.instance.match.applyCardAt(e)}findCloseOrFarSpot(e,t,n=!0){let i=St.instance.match,a=e.pos,s=0;for(let e=0;e<=i.map.width;e++)for(let r=0;r<=i.map.height;r++){let o=new d(e,r);if(i.isWalkable(o)){let e=J(i,t,o);n?e&&e.length<s&&(s=e.length,a=o):e&&e.length>s&&(s=e.length,a=o)}}return a}idealSpot(e,t){let n=St.instance.match,i=(t.type.range,this.getEnemiesOf(e)),a=null;if(t.type.friendly&&console.log("Unit's don't know how to use friendly cards"),t.type.mobile){let n=this.closestTargetTo(e).pos;t.getTilesInRange(e).forEach((e=>{if(a){let t=a.distance(n);e.distance(n)<t&&(a=e)}else a=e}))}else i.forEach((i=>{let s=t.getTilesInRange(i);t.type.mobile&&(s=t.getTilesInRange(e)),s.forEach((t=>{let i=J(n,e.pos,t);if(i)if(null==a){void 0!==J(n,e.pos,t)&&(a=t)}else{let s=J(n,e.pos,a);s&&i.length<s.length&&(a=t)}}))}));return a}friendlySpace(e){let t,n=St.instance.match;return n.teams[e.teamNumber].units.forEach((i=>{if(i.teamNumber==e.teamNumber){Pe(i.pos,0,20).forEach((i=>{let a=J(n,e.pos,i);if(a)if(null==t)t=i;else{let s=J(n,e.pos,t);a.length<s.length&&(t=i)}}))}})),t}getPath(e,t){return J(St.instance.match,e.pos,t,100)}moveTowards(e,t){let n=St.instance.match,i=(this.findCloseOrFarSpot(e,t),J(n,e.pos,t));if(i){let t=Math.min(i.length,e.speed),n=i.slice(0,t);e.walkPath(n)}else console.log("Invlaid path request!",e.pos," cannot reach: ",t)}}class Je{get zoom(){return Math.SQRT2**this.zoomLevel}constructor(){this.velocityDecay=.85,this.position=new d(600,600),this.velocity=new d(0,0),this.zoomLevel=-3,this.rotation=0}worldToCamera(e,t){let{x:n,y:i}=this.position,{zoom:a,rotation:s}=this;return p.transformation(-n,-i,-s,a,a,e/2,t/2)}cameraToWorld(e,t){return this.worldToCamera(e,t).inverse()}worldPosition(e,t,n){return this.cameraToWorld(e,t).multiplyVec(n)}onKeyup(e){"="==e.key&&this.changeZoom(!0),"-"==e.key&&this.changeZoom(!1)}onWheel(e){this.changeZoom(Math.sign(e.deltaY)<0)}changeZoom(e){let t=e?1:-1;this.zoomLevel=c(-4,4,this.zoomLevel+t)}update(){let e=St.instance,{input:t}=e,n=1/this.zoom;t.keys.get("w")&&(this.velocity.y+=-n,this.targetPosition=void 0),t.keys.get("s")&&(this.velocity.y+=n,this.targetPosition=void 0),t.keys.get("a")&&(this.velocity.x+=-n,this.targetPosition=void 0),t.keys.get("d")&&(this.velocity.x+=n,this.targetPosition=void 0);if(t.keys.get("]")&&(this.rotation+=.01),t.keys.get("[")&&(this.rotation-=.01),this.position=this.position.add(this.velocity),this.velocity=this.velocity.scale(this.velocityDecay),this.targetPosition){let e=this.position.lerp(this.targetPosition,.05);this.velocity=e.subtract(this.position),this.isInFocusArea(this.targetPosition)&&(this.targetPosition=void 0)}if(this.lastDragPosition){this.targetPosition=void 0;let n=t.cursor,i=this.lastDragPosition.subtract(n),a=z.relativeMatrix(e.match.scene).inverse().multiplyVec(i,0);this.velocity=a,this.lastDragPosition=n}}startDragging(){this.lastDragPosition=St.instance.input.cursor}stopDragging(){this.lastDragPosition=void 0}distFromViewport(e){let t=St.instance.screenCenter(),n=e.subtract(t),i=Math.abs(n.x)-t.x,a=Math.abs(n.y)-t.y;return Math.max(i,a)}isInFocusArea(e){let t=St.instance.screenDimensions(),n=this.worldToCamera(t.x,t.y).multiplyVec(e);return this.distFromViewport(n)<2*-ze.tileSize}setCameraTarget(e){this.isInFocusArea(e)||(this.targetPosition=e)}}class ze{constructor(e=St.instance.team){this.camera=new Je,this.timer=0,this.turn=0,this.cardTray=new _e,this.unitTray=new Ke,this.aiTeamNumbers=[-1,1],this.ai=new Ne,this.cardAnim={rate:.02,cap:1,step:1,type:void 0,pos:new d(0,0)},this.scene={localMatrix:p.identity},this.map=new _(15,15),this.teams=[e,new O("Drunken Scholars",[],!0,1)],window.addEventListener("keyup",(e=>this.onKeyup(e)))}get units(){let e=this.teams;return function*(){for(let t of e)for(let e of t.units)yield e}()}moveCamToUnit(e){e&&this.camera.setCameraTarget(e.pos.addXY(.5,.5).scale(ze.tileSize))}moveCamToFirstUnit(){let e=this.activeTeam().units;0!=e.length&&this.moveCamToUnit(e[0])}generateMap(){this.map.newMap(),this.placeUnits()}generateBoss(){let e=[];return e.push(St.instance.randomBoss),new O("Drunken Scholars",e,!0,1)}generateEnemies(e){let t=[],n=(i=(e+=1)/20,Math.ceil(Math.random()*i));var i;e-=20*n;let a=Math.floor(e/5);for(let e=0;e<n;e++)t.push(St.instance.randomUnit);if(n)for(let e=0;e<a;e++){let e=t[r(t.length)],n=new Be(Le());e.draw.cards.push(n)}return t.forEach((e=>{e.statReset()})),new O("Drunken Scholars",t,!0,1)}playerTurn(){return 0==this.turn}placeUnits(){this.teams.forEach((e=>{this.map.placeUnits(e.units)}))}activeTeam(){return this.teams[this.turn]}playerUnits(){return this.teams[0].units}selectedUnit(){return this.activeTeam().selectedUnit()}selectedCard(){return this.selectedUnit()?.hand.cards[this.cardTray.index]}isPickingCard(){return this.cardTray.isPickingTarget}goBack(){let{unitTray:e,cardTray:t}=this;t.isPickingTarget?t.deselect():this.activeTeam().deselect()}applyCardAt(e){let t=this.selectedUnit(),n=this.selectedCard();if(this.cardTray.deselect(),t&&n){let i={energy:null==n.type.cost?0:n.type.cost,speed:null==n.type.speedCost?0:n.type.speedCost},a=t.energy>=i.energy,s=t.speed>=i.speed;if(a&&s){let i=t.hand.cards.indexOf(n);if(i<0)throw new Error("Selected card is not in selected unit's hand.");t.hand.cards.splice(i,1),n.type.exhaustive||t.discard.cards.push(n),n.apply(t,e),this.animateCard(e,n.type)}}}animateCard(e,t){this.cardAnim.step=0,this.cardAnim.type=t,this.cardAnim.pos=e}getUnit(e){for(let t of this.teams)for(let n of t.units)if(n.pos.equals(e))return n}isWalkable(e,t=!0){return(!t||!this.getUnit(e))&&(this.map.contains(e)&&this.map.isEmpty(e))}hasFocus(){return"match"==St.instance.mouseOverData.node?.description}tileSpaceCursor(){let e=St.instance.input.cursor;return z.toLocalSpace(e,this.scene).scale(1/ze.tileSize).floor()}endTurn(){if(this.teams[this.turn].endTurn(),this.turn++,this.turn%=this.teams.length,this.teams[this.turn].startTurn(),this.timer+=1,0==this.playerUnits().length&&St.instance.changeStage("lose"),0==this.teams[1].units.length){let e=St.instance;e.match.turn=0,e.scrip+=e.scripReward,e.changeStage("route")}else this.activeTeam().cycleUnits(),this.moveCamToUnit(this.activeTeam().selectedUnit())}start(){let e=St.instance;this.teams[0]=e.team,e.team.units.forEach((e=>{e.statReset()})),this.map=new _(15,15);let t=Math.floor(11.5*e.level);this.teams[1]=this.generateEnemies(t),this.generateMap(),this.turn=0,this.activeTeam().cycleUnits(),this.activeTeam().selectedUnit()&&this.moveCamToUnit(this.activeTeam().selectedUnit()),this.turn=0,e.activity="match"}startBoss(){let e=St.instance;this.teams[0]=e.team,e.team.units.forEach((e=>{e.statReset()})),this.map=new _(15,15),this.teams[1]=this.generateBoss(),this.generateMap(),this.turn=0,this.activeTeam().cycleUnits(),this.activeTeam().selectedUnit()&&this.moveCamToUnit(this.activeTeam().selectedUnit()),this.turn=0,e.activity="match"}onMousedown(e){let t=St.instance,n=e.button,i=1==n,a=2==n;if(0==n||i){let e=t.input.cursor,n=z.pickNode(this.scene,e),a=n==this.scene,s=null==n,r=void 0!==this.activeTeam().selectedUnit()&&!this.isPickingCard();((a||s)&&!r||t.input.keys.get("shift")||i)&&this.camera.startDragging()}else a&&this.goBack()}onMouseup(e){this.camera.stopDragging(),console.log(e)}onWheel(e){this.camera.onWheel(e)}onKeyup(e){this.camera.onKeyup(e),"match"==St.instance.activity&&this.playerTurn()&&("Tab"==e.key&&this.activeTeam().cycleUnits(),"Escape"==e.key&&this.goBack(),"Enter"==e.key&&this.endTurn())}update(){this.camera.update(),this.teams.forEach((e=>{e.update()})),0!=this.teams[0].length&&0!=this.teams[1].length||this.endTurn(),this.activeTeam().selectedUnit()&&this.cardTray.update(this.activeTeam().selectedUnit());let{step:e,cap:t,type:n}=this.cardAnim;if(e<t&&n){let e=n.renderFrames?this.cardAnim.cap/n.renderFrames:.1;this.cardAnim.step+=e}if(!this.playerTurn()){let e=this.ai;e.update(),null==e.startTime&&e.think(this.activeTeam()),e.chodiness>=e.maxChodiness&&(this.activeTeam().selectedUnitIndex>=this.activeTeam().units.length-1?(this.endTurn(),this.activeTeam().cycleUnits(),this.playerUnits.length>0&&this.moveCamToUnit(this.selectedUnit()),e.reset()):(this.activeTeam().cycleUnits(),this.moveCamToUnit(this.selectedUnit()),e.reset()))}}render(){let e=k.instance,t=(St.instance,ze.tileSize);this.camera.zoom*St.uiScale<=1.5&&(e.c.imageSmoothingEnabled=!0,e.c.imageSmoothingQuality="low"),this.drawMap();let n=this.tileSpaceCursor(),i=this.activeTeam().selectedUnit(),a=this.isWalkable(n);if(this.playerTurn()&&this.hasFocus()&&a&&null!=i&&-1==this.cardTray.index&&i.speed>0){Pe(i.pos,0,i.speed).forEach((n=>{let a=J(this,i.pos,n,i.speed);a&&a.length<=i.speed&&(e.drawRect(n.scale(t),new d(t,t),"rgba(0, 0, 255, 0.1)"),e.strokeRect(n.scale(t),new d(t,t),"rgba(0, 0, 255, 0.1)"))}));let a=J(this,i.pos,n,100);if(a&&i.canMove()){let s=a.length,r=Math.min(a.length,i.speed),o=a.slice(r-1),l=a.slice(0,r);a.length=r;let c=3;e.c.save();{const i="rgb(0, 240, 0)",h="#c9c5b955";let p="rgb(30, 115, 30)";if(e.makePath(l.map((e=>e.add(d.one.scale(.5)).scale(t)))),e.c.strokeStyle=p,e.c.lineWidth=c+2,e.c.stroke(),e.c.strokeStyle=i,e.c.lineWidth=c,e.c.stroke(),r!=s){e.makePath(o.map((e=>e.add(d.one.scale(.5)).scale(t)))),e.c.strokeStyle=h,e.c.lineWidth=c,e.c.stroke(),e.c.setLineDash([]),e.c.beginPath();let i=n.add(d.one.scale(.5)).scale(t);e.c.fillStyle=h,e.c.fillRect(i.x-c,i.y-c,2*c,2*c)}e.c.beginPath();let m=a[a.length-1].add(d.one.scale(.5)).scale(t);e.c.fillStyle=i,e.c.fillRect(m.x-c,m.y-c,2*c,2*c)}e.c.restore()}}let{step:s,cap:r,type:o,pos:l}=this.cardAnim;i&&s<r&&o?.render&&i&&o.render(s,i,l)}drawMap(e=!1){let t=k.instance,n=this.map,i=ze.tileSize;for(let e=0;e<n.height;e++)for(let t=0;t<n.width;t++){let a=new d(t*i,e*i),s=n.getFromXY(t,e);s.getElevation()<=0&&s.render(a.x,a.y)}for(let a=0;a<n.height;a++)for(let s=0;s<n.width;s++){let r=new d(s*i,a*i),o=n.getFromXY(s,a);if(o.getElevation()>=0&&(C.render(r.x,r.y),o.render(r.x,r.y)),e){let e=new d(s*i+1,a*i+1),n=s.toString()+", "+a.toString();t.setFont(i/8|0,"pixel"),t.drawText(e,n,"#f0ead8")}}}makeSceneNode(){let e=St.instance,t=k.instance,{teams:n}=this,{width:i,height:a}=this.map,s=this.activeTeam().selectedUnit(),r=this.isPickingCard(),o=ze.tileSize;this.scene=z.node({description:"match",localMatrix:this.cameraTransform(),rect:{width:i*o,height:a*o},onClick:(e,t)=>{if(this.playerTurn()&&s&&s.canMove()&&!r){let e=t.scale(1/o).floor(),n=J(this,s.pos,e,100);n&&(n.length=Math.min(n.length,s.speed),s.walkPath(n))}},content:()=>{for(let e of this.units)e.makeSceneNode();if(r){let n=this.selectedCard();if(s&&n)for(let i of n?.getTilesInRange(s)){let a=this.getUnit(i),s=a||n?.type.canApplyToEmptyTiles;z.node({description:"card-target",localMatrix:p.vTranslation(i.scale(o)),rect:{width:o,height:o},onClick:()=>{this.playerTurn()&&s&&this.applyCardAt(i)},onRender:r=>{let l=r==e.mouseOverData.node&&s,c=s?.5:.15,h=`rgba(135, 231, 255, ${c})`,p=`rgba(3, 202, 252, ${c})`;t.c.fillStyle=l?h:p;let m=[i];St.instance.match.map.contains(i)&&(n?.type.getTilesEffected&&(m=n?.type.getTilesEffected(this.selectedUnit(),i)),l&&m.forEach(((e,n)=>{let a=new d(e.x,e.y).subtract(i).scale(o);t.c.fillStyle=l?h:p,t.c.strokeStyle=`rgba(0, 173, 217, ${c})`,t.c.beginPath(),t.c.rect(a.x,a.y,o,o),t.c.fill(),t.c.stroke()})),t.c.strokeStyle=`rgba(0, 173, 217, ${c})`,t.c.beginPath(),t.c.rect(0,0,o,o),t.c.fill(),t.c.stroke(),a?.drawStats())}})}}},onRender:()=>this.render()})}cameraTransform(){let e=St.instance.screenDimensions();return this.camera.worldToCamera(e.x,e.y)}}ze.tileSize=32;class Oe{constructor(){Oe.instance=this,this.keys=new Map,this.codes=new Map,this.mouse=new Map,this.cursor=new d(0,0),window.addEventListener("mousedown",(e=>this.mouse.set(e.button,!0))),window.addEventListener("mouseup",(e=>this.mouse.set(e.button,!1))),window.addEventListener("keydown",(e=>{this.keys.set(e.key.toLowerCase(),!0),this.codes.set(e.code,!0)})),window.addEventListener("keyup",(e=>{this.keys.set(e.key.toLowerCase(),!1),this.codes.set(e.code,!1)})),window.addEventListener("mousemove",(e=>this.cursor=new d(e.x,e.y)))}}class $e{constructor(){$e.instance=this,this.lastFrame=performance.now(),this.averageFPS=0,this.dt=16}get dtSeconds(){return this.dt/1e3}nextFrame(){let e=performance.now(),t=e-this.lastFrame;if(this.dt=t,this.lastFrame=e,0!=t){let e=1e3/t;this.averageFPS=h(this.averageFPS,e,.04)}return t}}var qe="\n    Michael\n    Christopher\n    Jessica\n    Matthew\n    Ashley\n    Jennifer\n    Joshua\n    Amanda\n    Daniel\n    David\n    James\n    Robert\n    John\n    Joseph\n    Andrew\n    Ryan\n    Brandon\n    Jason\n    Justin\n    Sarah\n    William\n    Jonathan\n    Stephanie\n    Brian\n    Nicole\n    Nicholas\n    Anthony\n    Heather\n    Eric\n    Elizabeth\n    Adam\n    Megan\n    Melissa\n    Kevin\n    Steven\n    Thomas\n    Timothy\n    Christina\n    Kyle\n    Rachel\n    Laura\n    Lauren\n    Amber\n    Brittany\n    Danielle\n    Richard\n    Kimberly\n    Jeffrey\n    Amy\n    Crystal\n    Michelle\n    Tiffany\n    Jeremy\n    Benjamin\n    Mark\n    Emily\n    Aaron\n    Charles\n    Rebecca\n    Stephen\n    Patrick\n    Sean\n    Erin\n    Zachary\n    Jamie\n    Kelly\n    Samantha\n    Nathan\n    Sara\n    Dustin\n    Paul\n    Angela\n    Tyler\n    Scott\n    Katherine\n    Andrea\n    Gregory\n    Erica\n    Mary\n    Travis\n    Lisa\n    Kenneth\n    Bryan\n    Lindsey\n    Kristen\n    Jose\n    Alexander\n    Jesse\n    Katie\n    Lindsay\n    Shannon\n    Vanessa\n    Courtney\n    Christine\n    Alicia\n    Allison\n    Bradley\n    Samuel\n    Shawn\n    April\n    Derek\n    Kathryn\n    Kristin\n    Chad\n    Jenna\n    Tara\n    Maria\n    Krystal\n    Jared\n    Anna\n    Edward\n    Julie\n    Peter\n    Holly\n    Marcus\n    Kristina\n    Natalie\n    Jordan\n    Victoria\n    Jacqueline\n    Corey\n    Keith\n    Monica\n    Juan\n    Donald\n    Cassandra\n    Meghan\n    Joel\n    Shane\n    Phillip\n    Patricia\n    Brett\n    Ronald\n    Catherine\n    George\n    Antonio\n    Cynthia\n    Stacy\n    Kathleen\n    Raymond\n    Carlos\n    Brandi\n    Douglas\n    Nathaniel\n    Ian\n    Craig\n    Brandy\n    Alex\n    Valerie\n    Veronica\n    Cory\n    Whitney\n    Gary\n    Derrick\n    Philip\n    Luis\n    Diana\n    Chelsea\n    Leslie\n    Caitlin\n    Leah\n    Natasha\n    Erika\n    Casey\n    Latoya\n    Erik\n    Dana\n    Victor\n    Brent\n    Dominique\n    Frank\n    Brittney\n    Evan\n    Gabriel\n    Julia\n    Candice\n    Karen\n    Melanie\n    Adrian\n    Stacey\n    Margaret\n    Sheena\n    Wesley\n    Vincent\n    Alexandra\n    Katrina\n    Bethany\n    Nichole\n    Larry\n    Jeffery\n    Curtis\n    Carrie\n    Todd\n    Blake\n    Christian\n    Randy\n    Dennis\n    Alison\n    Trevor\n    Seth\n    Kara\n    Joanna\n    Rachael\n    Luke\n    Felicia\n    Brooke\n    Austin\n    Candace\n    Jasmine\n    Jesus\n    Alan\n    Susan\n    Sandra\n    Tracy\n    Kayla\n    Nancy\n    Tina\n    Krystle\n    Russell\n    Jeremiah\n    Carl\n    Miguel\n    Tony\n    Alexis\n    Gina\n    Jillian\n    Pamela\n    Mitchell\n    Hannah\n    Renee\n    Denise\n    Molly\n    Jerry\n    Misty\n    Mario\n    Johnathan\n    Jaclyn\n    Brenda\n    Terry\n    Lacey\n    Shaun\n    Devin\n    Heidi\n    Troy\n    Lucas\n    Desiree\n    Jorge\n    Andre\n    Morgan\n    Drew\n    Sabrina\n    Miranda\n    Alyssa\n    Alisha\n    Teresa\n    Johnny\n    Meagan\n    Allen\n    Krista\n    Marc\n    Tabitha\n    Lance\n    Ricardo\n    Martin\n    Chase\n    Theresa\n    Melinda\n    Monique\n    Tanya\n    Linda\n    Kristopher\n    Bobby\n    Caleb\n    Ashlee\n    Kelli\n    Henry\n    Garrett\n    Mallory\n    Jill\n    Jonathon\n    Kristy\n    Anne\n    Francisco\n    Danny\n    Robin\n    Lee\n    Tamara\n    Manuel\n    Meredith\n    Colleen\n    Lawrence\n    Christy\n    Ricky\n    Randall\n    Marissa\n    Ross\n    Mathew\n    Jimmy\n    Abigail\n    Kendra\n    Carolyn\n    Billy\n    Deanna\n    Jenny\n    Jon\n    Albert\n    Taylor\n    Lori\n    Rebekah\n    Cameron\n    Ebony\n    Wendy\n    Angel\n    Micheal\n    Kristi\n    Caroline\n    Colin\n    Dawn\n    Kari\n    Clayton\n    Arthur\n    Roger\n    Roberto\n    Priscilla\n    Darren\n    Kelsey\n    Clinton\n    Walter\n    Louis\n    Barbara\n    Isaac\n    Cassie\n    Grant\n    Cristina\n    Tonya\n    Rodney\n    Bridget\n    Joe\n    Cindy\n    Oscar\n    Willie\n    Maurice\n    Jaime\n    Angelica\n    Sharon\n    Julian\n    Jack\n    Jay\n    Calvin\n    Marie\n    Hector\n    Kate\n    Adrienne\n    Tasha\n    Michele\n    Ana\n    Stefanie\n    Cara\n    Alejandro\n    Ruben\n    Gerald\n    Audrey\n    Kristine\n    Ann\n    Shana\n    Javier\n    Katelyn\n    Brianna\n    Bruce\n    Deborah\n    Claudia\n    Carla\n    Wayne\n    Roy\n    Virginia\n    Haley\n    Brendan\n    Janelle\n    Jacquelyn\n    Beth\n    Edwin\n    Dylan\n    Dominic\n    Latasha\n    Darrell\n    Geoffrey\n    Savannah\n    Reginald\n    Carly\n    Fernando\n    Ashleigh\n    Aimee\n    Regina\n    Mandy\n    Sergio\n    Rafael\n    Pedro\n    Janet\n    Kaitlin\n    Frederick\n    Cheryl\n    Autumn\n    Tyrone\n    Martha\n    Omar\n    Lydia\n    Jerome\n    Theodore\n    Abby\n    Neil\n    Shawna\n    Sierra\n    Nina\n    Tammy\n    Nikki\n    Terrance\n    Donna\n    Claire\n    Cole\n    Trisha\n    Bonnie\n    Diane\n    Summer\n    Carmen\n    Mayra\n    Jermaine\n    Eddie\n    Micah\n    Marvin\n    Levi\n    Emmanuel\n    Brad\n    Taryn\n    Toni\n    Jessie\n    Evelyn\n    Darryl\n    Ronnie\n    Joy\n    Adriana\n    Ruth\n    Mindy\n    Spencer\n    Noah\n    Raul\n    Suzanne\n    Sophia\n    Dale\n    Jodi\n    Christie\n    Raquel\n    Naomi\n    Kellie\n    Ernest\n    Jake\n    Grace\n    Tristan\n    Shanna\n    Hilary\n    Eduardo\n    Ivan\n    Hillary\n    Yolanda\n    Alberto\n    Andres\n    Olivia\n    Armando\n    Paula\n    Amelia\n    Sheila\n    Rosa\n    Robyn\n    Kurt\n    Dane\n    Glenn\n    Nicolas\n    Gloria\n    Eugene\n    Logan\n    Steve\n    Ramon\n    Bryce\n    Tommy\n    Preston\n    Keri\n    Devon\n    Alana\n    Marisa\n    Melody\n    Rose\n    Barry\n    Marco\n    Karl\n    Daisy\n    Leonard\n    Randi\n    Maggie\n    Charlotte\n    Emma\n    Terrence\n    Justine\n    Britney\n    Lacy\n    Jeanette\n    Francis\n    Tyson\n    Elise\n    Sylvia\n    Rachelle\n    Stanley\n    Debra\n    Brady\n    Charity\n    Hope\n    Melvin\n    Johanna\n    Karla\n    Jarrod\n    Charlene\n    Gabrielle\n    Cesar\n    Clifford\n    Byron\n    Terrell\n    Sonia\n    Julio\n    Stacie\n    Shelby\n    Shelly\n    Edgar\n    Roxanne\n    Dwayne\n    Kaitlyn\n    Kasey\n    Jocelyn\n    Alexandria\n    Harold\n    Esther\n    Kerri\n    Ellen\n    Abraham\n    Cedric\n    Carol\n    Katharine\n    Shauna\n    Frances\n    Antoine\n    Tabatha\n    Annie\n    Erick\n    Alissa\n    Sherry\n    Chelsey\n    Franklin\n    Branden\n    Helen\n    Traci\n    Lorenzo\n    Dean\n    Sonya\n    Briana\n    Angelina\n    Trista\n    Bianca\n    Leticia\n    Tia\n    Cody\n    Kristie\n    Stuart\n    Laurie\n    Harry\n    Leigh\n    Elisabeth\n    Alfredo\n    Aubrey\n    Ray\n    Arturo\n    Joey\n    Kelley\n    Max\n    Andy\n    Latisha\n    Johnathon\n    India\n    Eva\n    Ralph\n    Yvonne\n    Warren\n    Kirsten\n    Miriam\n    Kelvin\n    Lorena\n    Staci\n    Anita\n    Rene\n    Cortney\n    Orlando\n    Carissa\n    Jade\n    Camille\n    Leon\n    Paige\n    Marcos\n    Elena\n    Brianne\n    Dorothy\n    Marshall\n    Daryl\n    Colby\n    Terri\n    Gabriela\n    Brock\n    Gerardo\n    Jane\n    Nelson\n    Tamika\n    Alvin\n    Chasity\n    Trent\n    Jana\n    Enrique\n    Tracey\n    Antoinette\n    Jami\n    Earl\n    Gilbert\n    Damien\n    Janice\n    Christa\n    Tessa\n    Kirk\n    Yvette\n    Elijah\n    Howard\n    Elisa\n    Desmond\n    Clarence\n    Alfred\n    Darnell\n    Breanna\n    Kerry\n    Nickolas\n    Maureen\n    Karina\n    Roderick\n    Rochelle\n    Rhonda\n    Keisha\n    Irene\n    Ethan\n    Alice\n    Allyson\n    Hayley\n    Trenton\n    Beau\n    Elaine\n    Demetrius\n    Cecilia\n    Annette\n    Brandie\n    Katy\n    Tricia\n    Bernard\n    Wade\n    Chance\n    Bryant\n    Zachery\n    Clifton\n    Julianne\n    Angelo\n    Elyse\n    Lyndsey\n    Clarissa\n    Meaghan\n    Tanisha\n    Ernesto\n    Isaiah\n    Xavier\n    Clint\n    Jamal\n    Kathy\n    Salvador\n    Jena\n    Marisol\n    Darius\n    Guadalupe\n    Chris\n    Patrice\n    Jenifer\n    Lynn\n    Landon\n    Brenton\n    Sandy\n    Leif\n    Leif\n    Leif\n    Kaden\n    Kaden\n    Kaden\n    Chase\n    Orion\n    Orion\n    Orion\n    Orion\n    Orion\n    Orion\n    Orion\n    Orion\n    Kody\n    Kody\n    Kody\n    Kody\n    Jaycob\n    Jaycob\n    Jaycob\n    Jaycob".split("\n").map((e=>e.trim()));class We{constructor(e=0){this.max=69,this.cards=[],this.pos=d.zero,this.offset=new d(1,1);for(let t=0;t<e;t++){let e=new Be;this.cards.push(e)}}get length(){return this.cards.length}typeCount(e){let t=0;return this.cards.forEach((n=>{n.type==e&&(t+=1)})),t}insertAt(e,t){if(0==this.length)return void this.cards.push(e);let n=this.cards[t];this.cards[t]=e,this.cards.push(n)}insertAtRandom(e){let t=Math.floor(Math.random()*this.length);this.insertAt(e,t)}add(e,t=1){for(let n=0;n<t;n++){let t=new Be(e);this.insertAtRandom(t)}}addCard(e){this.cards.length<this.max&&this.cards.push(e)}addCards(e){e.forEach((e=>{this.addCard(e)}))}addCardsatRandom(e){e.forEach((e=>{this.insertAtRandom(e)}))}removeCards(e){let t=e>this.length?this.length:e,n=[];for(let e=0;e<t;e++)n.push(this.cards.pop());return n}emptyInto(e){this.length>0?e.addCardsatRandom(this.removeCards(this.length)):console.log("Deck already empty:",e)}fillFrom(e){let{max:t,length:n}=this;if(n<t){let i=n==t?t:t-n;this.addCards(e.removeCards(i))}else console.log("already full:",e)}fillTill(e,t=this.length){let{length:n}=this;if(n<(t=t<this.max?t:this.max)){let i=n==t?t:t-n;this.addCards(e.removeCards(i))}else console.log("Already full:",e)}drawTill(e,t){t>e.length&&(t=e.length);for(let n=0;n<t;n++)if(e.cards.length>0){let t=e.cards.pop();this.cards.push(t)}}cardPosition(e){let{pos:t,offset:n}=this;return t.addXY(e*n.x,e*n.y)}}const Ye=b(a("6nzMk"));class je{constructor(e,t=0,n=Ye){this.draw=new We,this.hand=new We,this.discard=new We,this.hurtTime=0,this.walkAnimStep=0,this.walkAnimRate=10,this.sprite=n,this.name=qe[r(qe.length)],this.teamNumber=t,this.color="red",this.done=!1,this.pos=e,this.maxSpeed=5,this.speed=this.maxSpeed,this.maxEnergy=2,this.energy=this.maxEnergy,this.maxHealth=8,this.health=this.maxHealth,this.drawSpeed=4,this.hand.max=8}get team(){return St.instance.match.teams[this.teamNumber]}addHealth(e){let{energyArmor:t,plating:n}=De,i=[t,n],a=0;e<0&&(this.hurtTime+=.1*Math.sqrt(1-e),this.hand.cards.forEach(((t,n)=>{if(i.includes(t.type)&&a<Math.abs(e)){a+=t.type.damage;let e=this.hand.cards.splice(n,1);this.discard.cards.push(e[0])}}))),this.health+=e+a}addMaxHealth(e){this.maxHealth+=e,e<0&&(this.hurtTime+=.2*Math.sqrt(1-e))}addSpeed(e){this.speed+=e}addEnergy(e){this.energy+=e}capHealth(){let{health:e,maxHealth:t}=this;this.health=t<e?t:e}gainCard(e,t=1){for(let n=t;n>0;n--)this.hand.length<this.hand.max?this.hand.add(e):this.discard.add(e)}drawCard(e){for(let t=e;t>0;t--)if(this.draw.length>0){let e=this.draw.cards.pop();this.hand.cards.push(e)}else if(this.discard.emptyInto(this.draw),this.draw.length>0){let e=this.draw.cards.pop();this.hand.cards.push(e)}}discardCard(e=1){for(let t=e;t>0;t--)if(this.hand.length>0){let e=this.hand.cards.pop();this.discard.cards.push(e)}}discardCardAt(e){e<this.hand.length?this.discard.insertAtRandom(this.hand.cards.splice(e,1)[0]):console.log("Error: index is out of range in Unit hand")}move(e){this.pos=e[e.length-1],this.walkAnimStep=0,this.walkAnimPath=e}walkPath(e){this.energy>0&&this.speed>1&&(this.move(e),this.energy-=1)}cardCycle(){let{draw:e,hand:t,discard:n,drawSpeed:i}=this;t.length,e.length,n.length;n.fillFrom(t),t.fillTill(e,i),t.length<i&&(e.fillFrom(n),t.fillTill(e,i))}canMove(){return!this.isWalking()}isWalking(){return null!=this.walkAnimPath}statReset(){this.energy=this.maxEnergy,this.speed=this.maxSpeed,this.draw.fillFrom(this.hand),this.draw.fillFrom(this.discard),this.maxHealth=this.draw.length,this.health=this.maxHealth,this.cardCycle(),this.done=!1}statCap(){this.capHealth(),this.cardCycle(),this.done=!1}update(){let e=St.instance.clock.dt/1e3;this.hurtTime=Math.max(0,this.hurtTime-e);let t=this.walkAnimPath;t&&(this.walkAnimStep+=e*this.walkAnimRate,this.walkAnimStep+1>=t.length&&(this.walkAnimPath=void 0))}render(e=!0,t=!1){let n=k.instance,i=this.sprite.height/32,a=e?function(e,t=1/0,n=performance.now()/1e3){return Math.floor(n*e)%t}(2*i/2,i):0;if(e&&this.isWalking()){let e=this.walkAnimPath,t=Math.floor(this.walkAnimStep),i=this.walkAnimStep-t,a=e[t],s=e[t+1],r=a.lerp(s,i).subtract(this.pos);n.vTranslate(r.scale(ze.tileSize))}let s=e&&this.hurtTime>0;n.c.save(),s&&n.vTranslate(d.lissajous(this.hurtTime,13,10,2,1,0,0)),t&&(n.c.translate(32,0),n.c.scale(-1,1)),n.drawSheetFrame(this.sprite,32,0,0,a),n.c.restore()}renderName(e,t="#c2c2c2",n="#696969"){let i=k.instance;i.c.shadowBlur=0,i.setFont(4,"pixel2");let a=this.name;a.length>8&&(a=a.slice(0,5)+"..."),i.drawTextBox(e,a,{textColor:t,boxColor:n,alignY:R.bottom})}drawStats(){let e=k.instance;e.c.save(),e.c.translate(0,-7),this.drawEnergyPips(new d(3,4)),this.drawHealthPips(new d(.5,26.5)),this.drawSpeedPips(new d(.5,33)),e.c.restore()}drawEnergyPips(e){let t=k.instance,n={pip:{dim:e,pad:new d(1.5,0),filled:()=>`rgb(0, ${55*Math.random()+200}, 0)`,empty:"rgb(0, 100, 0)",pit:"rgb(0, 50, 0)",temp:"rgb(205, 255, 205)"},pos:new d(20,21.5),dim:new d(11.5,4),backingColor:"rgb(30, 125, 30)"};n.dim.x=this.energy*n.pip.dim.x+n.pip.pad.x*this.energy,t.drawRect(n.pos,n.dim,n.backingColor);let i=this.energy>this.maxEnergy?this.energy:this.maxEnergy;for(let e=0;e<i;e++){let i=n.pip.pad.scale(e),a=new d(n.pip.dim.scale(e).x,0).add(i),s=n.pos.add(new d(.5,0)).add(a);e>=this.energy?(t.drawRect(s,n.pip.dim,n.pip.pit),t.strokeRect(s,n.pip.dim,n.pip.empty)):e<this.maxEnergy?(t.strokeRect(s,n.pip.dim,n.pip.empty),t.drawRect(s,n.pip.dim,n.pip.filled())):(t.strokeRect(s,n.pip.dim,"yellow"),t.drawRect(s,n.pip.dim,n.pip.filled()))}}drawHealthPips(e){let t=k.instance,n={pos:e,dim:new d(33,4),pip:{dim:new d(2.5,4),pad:new d(1.5,0),filled:"rgb(255, 0, 0)",empty:"rgb(100, 0, 0)",pit:"rgb(75, 0, 0)",temp:"rgb(255, 205, 205)"},backingColor:"rgb(125, 10, 10)"};n.dim.x=this.maxHealth*n.pip.dim.x+n.pip.pad.x*this.maxHealth,t.drawRect(n.pos,n.dim,n.backingColor);let i=new d(o(.4),o(.4)),a=this.health>this.maxHealth?this.health:this.maxHealth;for(let e=0;e<a;e++){let a=n.pip.pad.scale(e),s=new d(n.pip.dim.scale(e).x,0).add(a),r=n.pos.add(new d(1,0)).add(s);if(e>=this.health)t.drawRect(r.add(i),n.pip.dim,n.pip.pit),t.strokeRect(r.add(i),n.pip.dim,n.pip.empty);else if(e<this.maxHealth)t.strokeRect(r,n.pip.dim,n.pip.empty),t.drawRect(r,n.pip.dim,n.pip.filled);else{let i=e-this.maxHealth;new d(0,0);a=n.pip.pad.scale(i).add(new d(2,2)),s=new d(n.pip.dim.scale(i).x,0).add(a),r=n.pos.add(new d(1,0)).add(s),t.strokeRect(r,n.pip.dim,"yellow"),t.drawRect(r,n.pip.dim,n.pip.filled)}i=new d(0,o(.4))}}drawSpeedPips(e){let t=k.instance,n={pos:e,dim:new d(33,4),pip:{dim:new d(2.5,4),pad:new d(1.5,0),filled:"rgb(100, 100, 255)",empty:"rgb(0, 0, 100)",pit:"rgb(0, 0, 75)",temp:"rgb(205, 205, 255)"},backingColor:"rgb(10, 10, 125)"};n.dim.x=this.maxSpeed*n.pip.dim.x+n.pip.pad.x*this.maxSpeed,t.drawRect(n.pos,n.dim,n.backingColor);let i=new d(o(.4),o(.4)),a=this.speed>this.maxSpeed?this.speed:this.maxSpeed;for(let e=0;e<a;e++){let a=n.pip.pad.scale(e),s=new d(n.pip.dim.scale(e).x,0).add(a),r=n.pos.add(new d(1,0)).add(s);if(e>=this.speed)t.drawRect(r.add(i),n.pip.dim,n.pip.pit),t.strokeRect(r.add(i),n.pip.dim,n.pip.empty);else if(e<this.maxSpeed)t.strokeRect(r,n.pip.dim,n.pip.empty),t.drawRect(r,n.pip.dim,n.pip.filled);else{let i=e-this.maxSpeed;new d(0,0);a=n.pip.pad.scale(i).add(new d(2,2)),s=new d(n.pip.dim.scale(i).x,0).add(a),r=n.pos.add(new d(1,0)).add(s),t.strokeRect(r,n.pip.dim,"white"),t.drawRect(r,n.pip.dim,n.pip.filled)}i=new d(o(.4),0)}}makeSceneNode(){let e=St.instance,t=e.match,n=k.instance,i=this.team,a=i==t.activeTeam(),{flipUnits:s}=i,r=i.selectedUnit(),o=ze.tileSize;z.node({description:this.name,localMatrix:p.vTranslation(this.pos.scale(o)),rect:{width:o,height:o},onClick:()=>{e.match.playerTurn()&&i.toggleSelectUnit(this)},onRender:t=>{let i=t==e.mouseOverData.node,l=this==r;n.c.save(),a&&(l&&(n.c.scale(1.3,1.3),n.c.translate(-3,-3),n.drawRect(new d(0,0),new d(o,o),"rgba(255, 255, 255, 0.4)")),l&&!this.isWalking()&&(n.c.shadowBlur=10,n.c.shadowColor="black")),s?n.drawRect(new d(0,0),new d(o,o),"#00000055"):n.drawRect(new d(0,0),new d(o,o),"#ffffff77"),this.render(!0,s),n.c.restore(),i&&this.drawStats()}})}}const Xe=b(a("1nAOW")),Ge=b(a("kB1Dc")),Ve=b(a("6nzMk")),Ze=b(a("fFTut"));b(a("gLbfg"));class Qe extends je{constructor(e,t){super(e,t),this.sprite=Ze,this.maxEnergy+=1,this.energy=this.maxEnergy,this.maxSpeed=5,this.speed=this.maxSpeed,this.maxHealth=7,this.health=this.maxHealth,this.draw.cards=[],this.draw.add(De.claw,3),this.draw.add(De.tentacle,2),this.draw.add(De.frenzy,2),this.draw.add(De.leap,1),this.cardCycle(),this.statReset()}}class et extends je{constructor(e,t){super(e,t),this.sprite=Ge,this.maxEnergy+=1,this.energy=this.maxEnergy,this.maxSpeed=3,this.speed=this.maxSpeed,this.maxHealth=10,this.health=this.maxHealth,this.draw.cards=[],this.drawSpeed=6,this.draw.add(De.plating,2),this.draw.add(De.gorge,1),this.draw.add(De.bouldertoss,2),this.draw.add(De.plateShift,1),this.draw.add(De.fuel,4),this.cardCycle(),this.statReset(),this.maxHealth=10,this.health=this.maxHealth}}class tt extends je{constructor(e,t){super(e,t),this.sprite=Ve,this.draw.cards=[],this.draw.add(De.barrier,3),this.draw.add(De.coreCharge,1),this.draw.add(De.rifle,3),this.cardCycle(),this.statReset()}}class nt extends je{constructor(e,t){super(e,t),this.sprite=Xe,this.maxEnergy+=1,this.energy=this.maxEnergy,this.maxSpeed=4,this.speed=this.maxSpeed,this.draw.cards=[],this.draw.add(De.bark,2),this.draw.add(De.sentience,2),this.draw.add(De.fungus,1),this.draw.add(De.boomShroom,1),this.cardCycle(),this.statReset()}}class it extends je{constructor(e,t){super(e,t),this.sprite=Ge,this.maxSpeed=5,this.speed=this.maxSpeed,this.drawSpeed=5,this.draw.cards=[],this.draw.add(De.plating,3),this.draw.add(De.exhaustPorts,1),this.draw.add(De.bouldertoss,2),this.draw.add(De.mine,1),this.cardCycle(),this.statReset()}}class at extends je{constructor(e,t){super(e,t),this.sprite=Ze,this.maxSpeed=5,this.speed=this.maxSpeed,this.maxHealth=9,this.health=this.maxHealth,this.draw.cards=[],this.draw.add(De.bloodClot,3),this.draw.add(De.frenzy,1),this.draw.add(De.leap,1),this.draw.add(De.acid,1),this.cardCycle(),this.statReset()}}b(a("3EpHn")),b(a("ljcCv")),b(a("eqjSU")),b(a("6AVs7"));const st=b(a("fwkUW"));class rt{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.unitTray=new Ke,this.stockTotal=4,this.stock=new We(this.stockTotal),this.isPlayerDone=!1;let e=St.instance;this.dialogue={text:"Buy something!",pos:new d(e.screenDimensions().x-150,70),offset:new d(0,0)},window.addEventListener("keyup",(e=>this.onKeyup(e)))}reset(){this.stock=new We(this.stockTotal)}onKeyup(e){let t=St.instance;"shop"==t.activity&&("Enter"==e.key&&(t.changeStage("route"),t.level+=1),"Tab"==e.key&&t.team.cycleUnits())}makeSceneNode(){let e=k.instance,t=St.instance,n=t.match;this.scene=z.node({localMatrix:p.identity,onRender:()=>{const n={pos:new d(t.screenCenter().x,0),size:new d(20,25),text:{size:30}};this.dialogue.pos=new d(St.instance.screenDimensions().x-150,70),e.c.imageSmoothingEnabled=!1,e.drawRect(new d(0,0),e.size,"rgba(205, 205, 255, 1)");let i=St.instance.match.selectedUnit();i&&(e.c.save(),e.c.translate(-20,-10),e.c.scale(7,7),i.render(!1),e.c.restore());for(let t=0;t<15;t++)e.drawRect(new d(0,0),new d(e.size.x,e.size.y/15*t),"rgba(50, 50, 50, 0.1)");e.c.drawImage(st,0,0,st.width,st.height,t.screenDimensions().x-150,80,150,150);let a=this.dialogue;if(a.text.length>0){e.setFont(10,"Pixel2");let t=Ie(a.text,15),n=a.pos.add(a.offset);t.forEach(((t,i)=>{e.drawTextBox(n.add(new d(6,42+10*i)),t,{boxColor:"rgba(60,60,150, 1)",alignX:S.center})}))}e.setFont(n.text.size,"Pixel2"),e.drawText(n.pos,"Part Shop","black",{boxColor:"rgba(0, 0, 100, 0.5)",alignX:S.center,padding:10});let s=new d(t.screenCenter().x,40);e.setFont(n.text.size-10,"Pixel2"),e.drawText(s,"Scrip: "+St.instance.scrip,"white",{boxColor:"rgba(150,60,60,0.9)",padding:5,alignX:S.center}),e.drawRect(new d(0,230),new d(t.screenDimensions().x,40),"black"),e.setFont(10,"Pixel2"),e.drawTextBox(new d(t.screenDimensions().x-150,240),"Press 'Enter' to leave",{})},content:()=>{this.unitTray.makeSceneNode(new d(0,0),t.team,!1);const i=t.screenDimensions(),a={dim:new d(i.x/5*3,1.3*Be.dimensions.y),pos:new d(i.x/7,.6*i.y),margin:10,cost:5,stockPos:e=>{let t=a.dim.x/this.stock.length;return new d(e*t+a.margin*e,0)}};let s=-1;z.node({description:"card-Shelf",rect:{width:a.dim.x,height:a.dim.y},localMatrix:p.identity.vTranslate(a.pos),onRender:()=>{e.setFont(13,"Times"),e.drawTextBox(new d(-50,35),"Cost: "+a.cost,{boxColor:"rgba(200, 80, 80, 0.9)"})},content:()=>{this.stock.cards.forEach(((t,i)=>z.node({description:"store-Stock",localMatrix:p.translation(a.stockPos(i).x,a.stockPos(i).y),scalar:5,rect:{width:Be.dimensions.x,height:Be.dimensions.y},onRender:()=>{t.render(),s==i&&e.strokeRect(t.pos,Be.dimensions,"rgba(255, 255, 255, 0.5)")},onHover:()=>{s=i},onClick:()=>{let e=St.instance;if(n.selectedUnit())if(e.scrip>=a.cost){e.scrip-=a.cost;let t=this.stock.cards.splice(i,1)[0];n.selectedUnit()?.draw.addCard(t),e.team.selectedUnit()?.statReset();let s=["Good Choice","I like that one","meh","At this rate I might pay off the boss","Would you like gift wrap?","Thats what everyone gets, try a lil originality"];this.dialogue.text=s[r(s.length)]}else{let e=["No scrip, no parts","I don't work for free bud","Sorry bud, I don't do charity","Come back with more money","You're short on scrip friend","You can't afford that pal","Come back when you're a little...Mmmmm 'Richer'"];this.dialogue.text=e[r(e.length)]}else this.dialogue.text="Hit 'Tab' to select which mech you want that on"}})))}})}})}}const ot=[b(a("3EpHn")),b(a("ljcCv")),b(a("eqjSU")),b(a("6AVs7"))];class lt{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.unitTray=new Ke,this.stockTotal=5,this.stock=new We(this.stockTotal),this.mechs=[],this.isPlayerDone=!1,lt.instance=this,this.image=ot[Math.floor(4*Math.random())],window.addEventListener("keyup",(e=>this.onKeyup(e)))}reset(){this.stock=new We(5),this.mechs=[];let e=[tt,nt,at,it];for(let t=0;t<3;t++){let t=e[r(e.length)];this.mechs.push(new t(new d(0,0),0))}}onKeyup(e){"Enter"==e.key&&(this.isPlayerDone=!0)}update(){this.makeSceneNode()}makeSceneNode(){let e=k.instance,t=St.instance;t.match;const n={pos:new d(t.screenCenter().x,25),size:new d(80,25),text:{size:30}},i={dim:new d(100,50),pos:new d(t.screenCenter().x-125,100),padding:10,bulk:10,text:{size:13,font:"Times"}},a={dim:new d(100,50),pos:new d(t.screenCenter().x+25,100),padding:10,bulk:10,text:{size:13,font:"Times"}};this.scene=z.node({localMatrix:p.identity,onRender:()=>{e.c.imageSmoothingEnabled=!1,e.c.drawImage(this.image,0,0,this.image.width,this.image.height,0,0,t.screenDimensions().x,t.screenDimensions().y),e.setFont(n.text.size,"Times New Roman"),e.drawTextBox(n.pos,"Vile Mechs",{textColor:"white",boxColor:"rgba(0, 0, 100, 0.5)",alignX:S.center,padding:10})},content:()=>{z.node({description:"start-button",rect:{width:i.dim.x,height:i.dim.y},localMatrix:p.identity.vTranslate(i.pos),onHover:()=>{i.padding+=i.bulk},onRender:()=>{let{padding:t,dim:n,text:a}=i;e.setFont(a.size,a.font),e.drawRoundTextBox(new d(n.scale(.5).x,0),"Start Game",{boxColor:"rgba(200, 80, 80, 0.6)",alignX:S.center,padding:t,borderRadius:8})},onClick:()=>{console.log("Trying to startGame!!!!!!"),St.instance.changeStage("origin")}}),z.node({description:"quit-button",rect:{width:a.dim.x,height:a.dim.y},localMatrix:p.identity.vTranslate(a.pos),onHover:()=>{a.padding+=a.bulk},onRender:()=>{let{padding:t,dim:n,text:i}=a;e.setFont(i.size,i.font),e.drawRoundTextBox(new d(n.scale(.5).x,0),"Quit Game",{boxColor:"rgba(200, 80, 80, 0.6)",alignX:S.center,padding:t,borderRadius:8})},onClick:()=>{console.log("Trying to quitGame!!!!!!"),window.close()}})}})}}const ct=[b(a("3EpHn")),b(a("ljcCv")),b(a("eqjSU")),b(a("6AVs7"))];b(a("fw68x"));class ht{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.isPlayerDone=!1,this.image=ct[Math.floor(4*Math.random())],this.options=[new it(new d(0,0),0),new tt(new d(0,0),0)]}makeSceneNode(){let e=k.instance,t=St.instance;t.match;this.scene=z.node({localMatrix:p.identity,onRender:()=>{e.c.imageSmoothingEnabled=!1,e.c.fillStyle="rgba(50, 50, 50, 1)",e.c.fillRect(0,0,e.size.x,e.size.y);for(let n=0;n<10;n++){let i=t.screenDimensions().scale(.05*n),a=t.screenDimensions().subtract(i.scale(2));e.c.fillStyle=`rgba(100, 100, 100, ${n/20})`,e.c.fillRect(i.x,i.y,a.x,a.y)}e.setFont(25,"Pixel2"),e.drawText(t.screenCenter().add(new d(0,-t.screenDimensions().scale(.4).y)),"Select Your Origin","white",{alignX:S.center})},content:()=>{const n=t.screenDimensions();let i={dim:new d(100,100),pos:new d(n.x/5-5,n.y/4*2)},a={dim:new d(100,100),pos:new d(n.x/4*1.85+5,n.y/4*2)},s=(new d(100,100),new d(n.x/4*3+5,n.y/4*2),"");z.node({description:"Select a Earth Mech backstory",localMatrix:p.identity.vTranslate(i.pos),rect:{width:i.dim.x,height:i.dim.y},onRender:()=>{e.c.imageSmoothingEnabled=!1;let t=this.options[0],n="rgb(75, 20, 20)";e.drawRect(new d(0,0),i.dim,"orange"),e.c.save(),e.c.translate(5,0),e.c.scale(1.5,1.5),t.render(),e.c.restore(),e.setFont(12,"Pixel2"),e.drawText(new d(5,50),"Roq Co:",n),e.setFont(5,"Pixel2"),e.drawText(new d(7,65),"Retired Miner, with a ",n),e.drawText(new d(7,70),"debt to pay off",n),e.drawText(new d(7,80),"High Area of Effect and Damage",n),"earth"==s&&e.strokeRect(new d(0,0),a.dim,"rgba(255, 255, 255)")},onHover:()=>{s="earth"},onClick:()=>{console.log("Begin with Earth mech"),St.instance.team.units=[new it(new d(0,0),0)],St.instance.changeStage("match")}}),z.node({description:"Select a Chrome Mech backstory",localMatrix:p.identity.vTranslate(a.pos),rect:{width:a.dim.x,height:a.dim.y},onRender:()=>{e.c.imageSmoothingEnabled=!1;let t=this.options[1];e.drawRect(new d(0,0),a.dim,"rgb(120, 120, 255)"),e.c.save(),e.c.translate(5,0),e.c.scale(1.5,1.5),t.render(),e.c.restore(),e.setFont(12,"Pixel2"),e.drawText(new d(5,50),"M&P inc:","white"),e.setFont(5,"Pixel2"),e.drawText(new d(7,65),"Ex Peace Agent with a","white"),e.drawText(new d(7,70),"debt to pay off","white"),e.drawText(new d(7,80),"High Defense and Damage","white"),"chrome"==s&&e.strokeRect(new d(0,0),a.dim,"rgba(255, 255, 255)")},onHover:()=>{s="chrome"},onClick:()=>{console.log("Begin with Chrome mech"),St.instance.team.units=[new tt(new d(0,0),0)],St.instance.changeStage("match")}})}})}}const dt=[b(a("3EpHn")),b(a("ljcCv")),b(a("eqjSU")),b(a("6AVs7"))];b(a("fw68x"));class pt{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.isPlayerDone=!1,this.image=dt[Math.floor(4*Math.random())],window.addEventListener("keyup",(e=>this.onKeyup(e)))}onKeyup(e){"Enter"==e.key&&(this.isPlayerDone=!0)}makeSceneNode(){let e=k.instance,t=St.instance;t.match;this.scene=z.node({localMatrix:p.identity,onRender:()=>{e.c.imageSmoothingEnabled=!1,e.c.fillStyle="rgba(50, 50, 50, 1)",e.c.fillRect(0,0,e.size.x,e.size.y);for(let n=0;n<10;n++){let i=t.screenDimensions().scale(.05*n),a=t.screenDimensions().subtract(i.scale(2));e.c.fillStyle=`rgba(100, 100, 100, ${n/20})`,e.c.fillRect(i.x,i.y,a.x,a.y)}e.setFont(25,"Pixel2"),e.drawText(t.screenCenter().add(new d(0,-t.screenDimensions().scale(.4).y)),"You Lost","white",{alignX:S.center})},content:()=>{const n=t.screenDimensions();let i={dim:new d(80,50),pos:new d(n.x/4-5,n.y/4*2)},a={dim:new d(80,50),pos:new d(n.x/4*2+5,n.y/4*2)},s="";z.node({description:"Try again",localMatrix:p.identity.vTranslate(i.pos),rect:{width:i.dim.x,height:i.dim.y},onRender:()=>{e.c.imageSmoothingEnabled=!1,e.drawRect(new d(0,0),i.dim,"white"),e.setFont(17,"Pixel2"),e.drawText(new d(5,20),"Retry?","black"),"retry"==s&&(e.c.lineWidth=5,e.strokeRect(new d(0,0),i.dim,"black"))},onHover:()=>{s="retry"},onClick:()=>{console.log("Trying to go again!"),St.instance.reset(),St.instance.changeStage("origin")}}),z.node({description:"Back to title",localMatrix:p.identity.vTranslate(a.pos),rect:{width:a.dim.x,height:a.dim.y},onRender:()=>{e.c.imageSmoothingEnabled=!1,e.drawRect(new d(0,0),a.dim,"black"),e.setFont(8,"Pixel2"),e.drawText(new d(5,20),"Back to Title?","white"),"quit"==s&&(e.c.lineWidth=5,e.strokeRect(new d(0,0),a.dim,"rgba(255, 255, 255)"))},onHover:()=>{s="quit"},onClick:()=>{console.log("Trying to Quit!"),St.instance.changeStage("title")}})}})}}const mt=[b(a("3EpHn")),b(a("ljcCv")),b(a("eqjSU")),b(a("6AVs7"))],gt=b(a("fwkUW"));class yt{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.unitTray=new Ke,this.isPlayerDone=!1,this.stock=[],this.image=mt[Math.floor(4*Math.random())],this.dialogue={text:"Buy something!",pos:new d(St.instance.screenDimensions().x-150,70),offset:new d(0,0)},window.addEventListener("keyup",(e=>this.onKeyup(e)))}reset(){this.stock=[new tt(new d(0,0),0),new it(new d(0,0),0),new nt(new d(0,0),0)]}onKeyup(e){let t=St.instance;"dealerShip"==t.activity&&("Enter"==e.key&&(t.changeStage("route"),t.level+=1),"Tab"==e.key&&t.team.cycleUnits())}makeSceneNode(){let e,t=k.instance,n=St.instance;n.match;this.scene=z.node({localMatrix:p.identity,onRender:()=>{const i={pos:new d(n.screenCenter().x,0),size:new d(20,25),text:{size:30}};this.dialogue.pos=new d(St.instance.screenDimensions().x-150,70),t.c.imageSmoothingEnabled=!1,t.drawRect(new d(0,0),t.size,"rgba(205, 205, 255, 1)"),void 0!==e&&(t.c.save(),t.c.translate(-20,-10),t.c.scale(7,7),this.stock[e].render(!1),t.c.restore());for(let e=0;e<15;e++)t.drawRect(new d(0,0),new d(t.size.x,t.size.y/15*e),"rgba(50, 50, 50, 0.1)");t.c.drawImage(gt,0,0,gt.width,gt.height,n.screenDimensions().x-150,80,150,150);let a=this.dialogue;if(a.text.length>0){t.setFont(10,"Pixel2");let e=Ie(a.text,15),n=a.pos.add(a.offset);e.forEach(((e,i)=>{t.drawTextBox(n.add(new d(6,42+10*i)),e,{boxColor:"rgba(60,60,150, 1)",alignX:S.center})}))}t.setFont(i.text.size,"Pixel2"),t.drawText(i.pos,"DealerShip","black",{boxColor:"rgba(0, 0, 100, 0.5)",alignX:S.center,padding:10});let s=new d(n.screenCenter().x,40);t.setFont(i.text.size-10,"Pixel2"),t.drawText(s,"Scrip: "+St.instance.scrip,"white",{boxColor:"rgba(150,60,60,0.9)",padding:5,alignX:S.center}),t.drawRect(new d(0,230),new d(n.screenDimensions().x,40),"black"),t.setFont(10,"Pixel2"),t.drawTextBox(new d(n.screenDimensions().x-150,240),"Press 'Enter' to leave",{})},content:()=>{this.unitTray.makeSceneNode(new d(0,0),n.team,!1);const i=n.screenDimensions(),a={dim:new d(i.x/5*3,1.3*Be.dimensions.y),pos:new d(i.x/7,.6*i.y),margin:10,cost:20,stockPos:e=>{let t=a.dim.x/this.stock.length;return new d(e*t+a.margin*e,0)}};let s=-1;z.node({description:"mech-Shelf",rect:{width:a.dim.x,height:a.dim.y},localMatrix:p.identity.vTranslate(a.pos),onRender:()=>{t.setFont(13,"Times"),t.drawTextBox(new d(-50,35),"Cost: "+a.cost,{boxColor:"rgba(200, 80, 80, 0.9)"})},content:()=>{this.stock.forEach(((n,i)=>z.node({description:"store-Stock",localMatrix:p.translation(a.stockPos(i).x,a.stockPos(i).y),scalar:7,rect:{width:Be.dimensions.x,height:Be.dimensions.y},onRender:()=>{t.c.save(),t.c.scale(1.5,1.5),n.render(),t.c.restore(),s==i&&t.strokeRect(n.pos,Be.dimensions,"rgba(255, 255, 255, 0.5)")},onHover:()=>{s=i,e=i},onClick:()=>{let e=St.instance;if(e.team.units.length<e.unitMax)if(e.scrip>=a.cost){e.scrip-=a.cost;let t=this.stock.splice(i,1)[0];e.team.units.push(t);let n=["Good Choice","I like that one","meh"];this.dialogue.text=n[r(n.length)]}else{let e=["No scrip, no parts","I don't work for free bud","Sorry bud, I don't do charity","Come back with more money","You're short on scrip friend","You can't afford that pal","Come back when you're a little...Mmmmm 'Richer'"];this.dialogue.text=e[r(e.length)]}else{let e=["You can't store any more bud","You've reached your max amount of Mechs pal","Come back with less Mechs"];this.dialogue.text=e[r(e.length)]}}})))}})}})}}b(a("3EpHn")),b(a("ljcCv")),b(a("eqjSU")),b(a("6AVs7"));const ut=b(a("fwkUW"));class wt{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.unitTray=new Ke,this.isPlayerDone=!1,this.cardTray=new _e;let e=St.instance;this.dialogue={text:"Hit 'Tab' to sell mech parts!",pos:new d(e.screenDimensions().x-150,70),offset:new d(0,0)},window.addEventListener("keyup",(e=>this.onKeyup(e)))}reset(){}toggleHand(){St.instance.team.selectedUnit()?.cardCycle()}onKeyup(e){let t=St.instance;"pawnShop"==t.activity&&("Enter"==e.key&&(t.changeStage("route"),t.level+=1),"Tab"==e.key&&(t.team.cycleUnits(),this.toggleHand(),this.dialogue.text="Sell something!"))}makeSceneNode(){let e=k.instance,t=St.instance;this.scene=z.node({localMatrix:p.identity,onRender:()=>{const n={pos:new d(t.screenCenter().x,0),size:new d(20,25),text:{size:30}};this.dialogue.pos=new d(St.instance.screenDimensions().x-150,70),e.c.imageSmoothingEnabled=!1,e.drawRect(new d(0,0),e.size,"rgba(205, 205, 255, 1)");let i=t.team.selectedUnit();i&&(e.c.save(),e.c.translate(-20,-10),e.c.scale(7,7),i.render(!1),e.c.restore());for(let t=0;t<15;t++)e.drawRect(new d(0,0),new d(e.size.x,e.size.y/15*t),"rgba(50, 50, 50, 0.1)");e.c.drawImage(ut,0,0,ut.width,ut.height,t.screenDimensions().x-150,80,150,150);let a=this.dialogue;if(a.text.length>0){e.setFont(10,"Pixel2");let t=Ie(a.text,15),n=a.pos.add(a.offset);t.forEach(((t,i)=>{e.drawTextBox(n.add(new d(6,42+10*i)),t,{boxColor:"rgba(60,60,150, 1)",alignX:S.center})}))}e.setFont(n.text.size,"Pixel2"),e.drawText(n.pos,"Pawn Shop","black",{boxColor:"rgba(0, 0, 100, 0.5)",alignX:S.center,padding:10});let s=new d(t.screenCenter().x,40);e.setFont(n.text.size-10,"Pixel2"),e.drawText(s,"Scrip: "+St.instance.scrip,"white",{boxColor:"rgba(150,60,60,0.9)",padding:5,alignX:S.center}),e.drawRect(new d(0,230),new d(t.screenDimensions().x,40),"black"),e.setFont(10,"Pixel2"),e.drawTextBox(new d(t.screenDimensions().x-150,240),"Press 'Enter' to leave",{})},content:()=>{this.unitTray.makeSceneNode(new d(0,0),t.team,!1),t.team.selectedUnit()&&this.cardTray.update(t.team.selectedUnit());const n=t.screenDimensions(),i={dim:new d(n.x/5*3,1.3*Be.dimensions.y),pos:new d(n.x/7,.6*n.y),margin:10,cost:10,stockPos:e=>{let n=0;return t.team.selectedUnit()&&(n=i.dim.x/t.team.selectedUnit().hand.cards.length),new d(e*n+i.margin*e,0)}};let a=-1;z.node({description:"card-Shelf",rect:{width:i.dim.x,height:i.dim.y},localMatrix:p.identity.vTranslate(i.pos),onRender:()=>{e.setFont(13,"Times"),e.drawTextBox(new d(-50,35),"Cost: "+i.cost,{boxColor:"rgba(200, 80, 80, 0.9)"})},content:()=>{t.team.selectedUnit()&&t.team.selectedUnit().hand.cards.forEach(((t,n)=>z.node({description:"store-Stock",localMatrix:p.translation(i.stockPos(n).x,i.stockPos(n).y),scalar:5,rect:{width:Be.dimensions.x,height:Be.dimensions.y},onRender:()=>{t.render(),a==n&&e.strokeRect(t.pos,Be.dimensions,"rgba(255, 255, 255, 0.5)")},onHover:()=>{a=n},onClick:()=>{let e=St.instance;if(e.team.selectedUnit())if(e.scrip>=i.cost){e.scrip-=i.cost,e.team.selectedUnit().hand.cards.splice(n,1),e.team.selectedUnit()?.statReset();let t=["Been looking for this part","I love this one","meh"];this.dialogue.text=t[r(t.length)]}else{let e=["No scrip, no parts","I don't work for free bud","Sorry bud, I don't do charity","Come back with more money","You're short on scrip friend","You can't afford that pal","Come back when you're a little, Mmm... 'Richer'"];this.dialogue.text=e[r(e.length)]}else this.dialogue.text="Hit 'Tab' to select which mech you want that on"}})))}})}})}}class ft{constructor(e){this.data=e,this.next=null,this.prev=null}}class xt{insertInBegin(e){const t=new ft(e);return this.head?(this.head.prev=t,this.head=t):this.head=t,t}insertAtEnd(e){const t=new ft(e);if(this.head){const e=t=>t.next?e(t.next):t,n=e(this.head);t.prev=n,n.next=t}else this.head=t;return t}deleteNode(e){if(e.prev){e.prev.next=e.next}else this.head=e.next}traverse(){const e=[];if(!this.head)return e;const t=n=>(e.push(n.data),n.next?t(n.next):e);return t(this.head)}size(){return this.traverse().length}search(e){const t=n=>e(n.data)?n:n.next?t(n.next):null;return this.head?t(this.head):null}constructor(){this.head=null}}b(a("fw68x"));class Tt{constructor(){this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.isPlayerDone=!1,this.selected=!1,this.pos=new d(0,0),this.scroll=0,this.options=[],this.reset(3),this.camera=new Je,window.addEventListener("keydown",(e=>this.onKeydown(e)))}onKeydown(e){St.instance.activity}get length(){return 6}reset(e=3){this.options=[this.getNewPath(1),this.getNewPath(3),this.getNewPath(6),this.getNewPath(4),this.getNewPath(2)]}getNewPath(e=3){let t=St.instance;const n=new xt;for(let i=0;i<e;i++){let a="match";i==e-1&&(a=t.randomShop),n.insertAtEnd({title:a})}return n}makeSceneNode(){let e=k.instance,t=St.instance;this.scene=z.node({localMatrix:p.identity,content:()=>{const n=t.screenDimensions();let i=new d(-1,-1);this.options.forEach(((a,s)=>{a.traverse().forEach(((a,r)=>{let o,l=new d(s,r);switch(a.title){case"match":o={id:"match",description:"Fight!",color:"rgb(255, 0, 0)",title:"Bounty Hunt"};break;case"shop":o={id:"shop",description:"Buy Cards",color:"rgb(20, 20, 175)",title:"Mechanic"};break;case"dealerShip":o={id:"dealerShip",description:"Buy Mechs",color:"rgb(50, 175, 50)",title:"Mech Dealer"};break;case"pawnShop":o={id:"pawnShop",description:"Remove Cards",color:"rgb(50, 0, 75)",title:"Pawn Shop"};break;default:o={id:"route",description:"mystery",color:"rgb(150, 150, 150)",title:"???"}}let c=new d(50,20),h=new d(n.x/6,n.y/6*5),m=new d(5*s+c.x*s,-5*r-c.y*r-this.scroll),g=h.add(m),y=r==t.level;z.node({description:o.description,localMatrix:p.identity.vTranslate(g),rect:{width:c.x,height:c.y},onRender:()=>{if(e.c.imageSmoothingEnabled=!1,e.drawRect(new d(0,0),c,o.color),e.setFont(6,"Pixel2"),e.drawText(new d(2,2),o.title,"white"),y||e.drawRect(new d(0,0),c,"rgba(0, 0, 0, 0.8)"),i.equals(l)&&y){let{color:t}=o;e.c.lineWidth=6;let n="rgba"+t.split("rgb")[1].toString().split(")")[0]+", 0.7)";e.strokeRect(new d(0,0),c,n)}else i.equals(l)&&(e.c.lineWidth=1,e.strokeRect(new d(0,0),c,"rgba(0, 0, 0)"))},onHover:()=>{i=new d(s,r)},onClick:y?()=>{St.instance.changeStage(o.id)}:()=>{}})}))}));let a=new d(50,0),s=new d(200,50),r=!1,o=t.level>=this.length;z.node({description:"Debt Collector",localMatrix:p.identity.vTranslate(a),rect:{width:s.x,height:s.y},onRender:()=>{e.c.imageSmoothingEnabled=!1,e.drawRect(a,s,"red"),e.setFont(25,"Pixel2"),e.drawText(a.add(new d(.12*s.x,.07*s.x)),"Boss Fight","white"),o?r&&(e.c.lineWidth=5,e.strokeRect(a,s,"white")):e.drawRect(a,s,"rgba(0, 0, 0, 0.8)")},onHover:()=>{r=!0},onClick:()=>{St.instance.changeStage("match")}})},onRender:()=>{e.c.imageSmoothingEnabled=!1,e.c.fillStyle="rgba(120, 120, 120, 1)",e.c.fillRect(0,0,e.size.x,e.size.y);for(let n=0;n<10;n++){let i=t.screenDimensions().scale(.05*n),a=t.screenDimensions().subtract(i.scale(2));e.c.fillStyle=`rgba(180, 160, 120, ${n/20})`,e.c.fillRect(i.x,i.y,a.x,a.y)}}})}}var bt;bt=new URL(a("27Lyk").resolve("cgtuV"),import.meta.url).toString();new Audio(bt);var kt;kt=new URL(a("27Lyk").resolve("eLZc0"),import.meta.url).toString();new Audio(kt);class St{constructor(){this.graphics=new k,this.input=new Oe,this.scene={localMatrix:p.scale(St.uiScale,St.uiScale)},this.mouseOverData={node:void 0,point:new d(0,0)},this.level=0,this.unitMax=3,this.showSceneDebug=!1,this.showFPS=!1,this.clock=new $e,this.isPlayerDone=!1,this.activity="title",St.instance=this,this.title=new lt,this.lose=new pt,this.origin=new ht,this.route=new Tt,this.store=new rt,this.store.reset(),this.dealerShip=new yt,this.dealerShip.reset(),this.pawnShop=new wt,this.pawnShop.reset(),this.scrip=20,this.scripRewards=[50,40,30,20,10];let e=[new it(new d(0,0),0)];this.team=new O("Choden Warriors",e,!1,0),this.match=new ze(this.team),"match"==this.activity&&this.match.start(),window.addEventListener("click",(e=>this.onClick(e))),window.addEventListener("resize",(e=>this.graphics.onResize())),window.addEventListener("keyup",(e=>this.onKeyup(e))),window.addEventListener("keydown",(e=>this.onKeydown(e)))}get randomUnit(){let e=[new tt(new d(0,0),1),new it(new d(0,0),1)];return e[r(e.length)]}get randomBoss(){let e=[new Qe(new d(0,0),1),new et(new d(0,0),1)];return e[r(e.length)]}get randomShop(){let e=["shop","pawnShop","dealerShip"];return e[r(e.length)]}reset(){this.level=1,this.scrip=20}changeStage(e){window.setTimeout((()=>{switch(e){case"match":this.level+=1,this.level>=this.route.length?this.match.startBoss():this.match.start();case"shop":this.store.reset(),this.activity=e;case"route":{let e=0;this.route.options.forEach((t=>{t.traverse().length>=e&&(e=t.traverse().length)})),this.level>e&&this.route.reset(6)}default:this.activity=e}}),100)}get scripReward(){let e=this.match.timer>=this.scripRewards.length?this.scripRewards.length-1:this.match.timer;return this.scripRewards[e]}update(){let{match:e}=this;this.clock.nextFrame(),"match"==this.activity&&this.match.update(),this.makeSceneNode(),this.mouseOverData=z.pick(this.scene,this.input.cursor);let{node:t,point:n}=this.mouseOverData;t?.onHover&&t.onHover(t,n)}onClick(e){let t=this.input.cursor,{node:n,point:i}=z.pick(this.scene,t);n&&!this.input.keys.get("shift")&&n.onClick&&n.onClick(n,i)}onKeyup(e){"`"==e.key&&(this.showSceneDebug=!this.showSceneDebug),","==e.key&&(this.showFPS=!this.showFPS)}onKeydown(e){"Tab"==e.key&&e.preventDefault()}render(){let e=this.graphics;e.c.imageSmoothingEnabled=!1,e.c.fillStyle="#2b69f5",e.c.fillRect(0,0,e.size.x,e.size.y),e.c.textBaseline="top";let t=z.pickNode(this.scene,this.input.cursor);this.showSceneDebug?(t&&(t.debugColor="white"),z.render(e.c,this.scene,!0),e.setFont(12,"pixel"),e.drawText(this.input.cursor.add(d.one.scale(20)),t?.description??"","white")):z.render(e.c,this.scene,!1),this.showFPS&&(e.setFont(24,"impact"),e.drawText(d.one.scale(2),this.clock.averageFPS.toFixed(2),"red"))}makeSceneNode(){let e=k.instance,{match:t,store:n}=this,{unitTray:i,cardTray:a}=this.match,s=this.match.activeTeam().selectedUnit(),r=St.instance.screenCenter();this.scene=z.node({localMatrix:p.scale(St.uiScale,St.uiScale),onRenderPost:()=>{"match"==this.activity&&(e.setFont(5,"pixel"),e.drawTextBox(new d(r.x/4,0),`SCRIP Reward: ${this.scripReward} `,{textColor:"#c2c2c2",boxColor:"rgba(200, 80, 80, 0.7)",alignX:S.left}),e.drawTextBox(new d(r.x/4,8),`SCRIP: ${this.scrip} `,{textColor:"#c2c2c2",boxColor:"rgba(200, 80, 80, 0.7)",alignX:S.left}))},content:()=>{switch(this.activity){case"shop":n.makeSceneNode();break;case"dealerShip":this.dealerShip.makeSceneNode();break;case"pawnShop":this.pawnShop.makeSceneNode();break;case"match":t.makeSceneNode(),e.c.restore(),0==this.match.turn?i.makeSceneNode(new d(0,0),t.teams[0]):i.makeSceneNode(new d(this.screenDimensions().x,0),t.activeTeam(),!0),s&&a.makeSceneNode(s);break;case"title":this.title.makeSceneNode();break;case"origin":this.origin.makeSceneNode();break;case"lose":this.lose.makeSceneNode();break;case"route":this.route.makeSceneNode()}}})}screenDimensions(){return this.graphics.size.scale(1/St.uiScale)}screenCenter(){return this.graphics.size.scale(.5/St.uiScale)}}St.uiScale=3,St.camVelocityDecay=.85;let Rt=new St;!function e(){Rt.update(),Rt.render(),window.requestAnimationFrame(e)}();
//# sourceMappingURL=index.ad6db622.js.map
